<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="https://www.w3.org/1999/xhtml">
<head>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Cousine&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="icon" type="image/ico" href="/images/favicon.ico" />
  <link rel="shortcut icon" type="image/png" href="/images/favicon.png" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title>Solar2D Documentation — Solar2D Native | Android</title>
  <meta name="description" content="Solar2D lets you build games/apps for all major platforms including iOS, Android, Kindle, Apple TV, Android TV, macOS, and Windows. Get the free toolset!" />
  <link rel="stylesheet" href="../../css/style.css" />
  <link rel="stylesheet" href="../../css/shCoreDefault.css" />
<script src="https://corona-cdn.coronalabs.com/js/docs.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-9574984-14', 'auto');
  ga('send', 'pageview');
</script>
</head>
<body>
<div class="header"></div>
<div class="title">
	<span class="titleimg" onclick="window.location='https://docs.coronalabs.com/'"></span>
	<div id="nav">
		<ul>
<li><a href="../../guide/programming/index.html">Getting Started</a></li>
<li><a href="../../guide/index.html">Guides</a></li>
<li><a href="../../api/index.html">API Reference</a></li>
<li><a href="../../tutorial/index.html">Tutorials</a></li>
<li><a href="../../plugin/index.html">Plugins</a></li>
<li><a href="../../native/index.html">Solar2D Native</a></li>
<li><a href="../../coronacards/index.html">CoronaCards</a></li>
</ul>

		<!--
		<div id="resources-link"><a href="https://coronalabs.com/resources/">Corona Resources</a></div>
		-->
	</div>
</div>

<div class="SearchBar">
  <form action="https://www.google.com/cse" id="cse-search-box">
  <input type="hidden" name="cx" value="009283852522218786394:g40gqt2m6rq" />
  <input type="hidden" name="ie" value="UTF-8" />
  <input type="text" placeholder="Search" name="q" id="q" autocomplete="off" size="40" />
  <input type="submit" name="sa" value="Search" />
  </form>
</div>
<div id="TOC">
<ul>
<li><a href="#solar2d-native-android">Solar2D Native — Android</a><ul>
<li><a href="#solar2d-native-setup">Solar2D Native Setup</a><ul>
<li><a href="#for-macos">For macOS</a></li>
</ul></li>
<li><a href="#project-templates">Project Templates</a></li>
<li><a href="#solar2d-native-development">Solar2D Native Development</a><ul>
<li><a href="#bridging-luajava">Bridging Lua/Java</a></li>
<li><a href="#native-apis">Native APIs</a></li>
<li><a href="#using-proguard">Using ProGuard</a></li>
<li><a href="#using-common-android-libraries">Using Common Android Libraries</a></li>
<li><a href="#runtime-permission-support">Runtime Permission Support</a></li>
</ul></li>
<li><a href="#building-for-devices">Building for Devices</a></li>
<li><a href="#building-for-self-hosted-plugins">Building for Self Hosted Plugins</a></li>
</ul></li>
</ul>
</div>
<div id="breadcrumb">
<a href="https://docs.coronalabs.com">Documentation</a>  ▸  <a href="../../native/index.html">Solar2D Native</a>  ▸  <a href="../../native/android/index.html">Android</a>
</div>
<section id="solar2d-native-android" class="level1">
<h1>Solar2D Native — Android</h1>
<p>The following resources go further in depth on using Solar2D Native for Android.</p>
<div class="guides-toc">
<ul>
<li><a href="#setup">Solar2D Native Setup</a></li>
<li><a href="#templates">Project Templates</a></li>
<li><a href="#development">Solar2D Native Development</a></li>
<li><a href="#building">Building for Devices</a></li>
<li><a href="#self-hosted">Building for Self-Hosted-Plugins</a></li>
</ul>
</div>
<p><a id="setup"></a></p>
<section id="solar2d-native-setup" class="level2">
<h2>Solar2D Native Setup</h2>
<p>Download and install <a href="https://developer.android.com/studio">Android Studio</a>, the official IDE for Android development.</p>
<section id="for-macos" class="level3">
<h3>For macOS</h3>
<p>Within the <code>/Applications/Corona/Native/</code> folder, double click <strong>Setup Corona Native</strong>. This will create the symbolic link required for the project templates.</p>
<p><a id="templates"></a></p>
</section>
</section>
<section id="project-templates" class="level2">
<h2>Project Templates</h2>
<p>New projects can easily be created by using template files as a starting point. Project template can be found:</p>
<ul>
<li>macOS: <nobr><code>/Applications/Corona/Native/Project Template/</code></nobr></li>
<li>Windows: <nobr><code>Native\Project Template</code></nobr> from Corona installation location. Shortcut to open this directory can be found in Start menu</li>
</ul>
<p>To start a new project, copy the <code>App</code> folder to desired location and rename it. Start Android Studio, click “Open an existing Android Studio Project”, and select <code>android</code> directory from copied <code>App</code> template.</p>
<div class="guide-notebox">
<p>Note, that opening <nobr><code>App/android</code></nobr> from original template location with Android Studio is error prone: install location is often in system protected folder. Copy it to folder with write access.</p>
</div>
<p>Inside your copy of the <code>App</code> folder, the following files/directories are of primary concern:</p>
<div class="tree">
<ul>
<li><code>Corona</code> — This folder represents a classic Corona project, containing files like <code>main.lua</code>, app icons, etc. By default, <nobr><code>build.gradle (Module: App)</code></nobr> is set up to assume that these files reside inside this exact folder (<code>Corona</code>).</li>
<li><code>android</code> — Contains all of the <nobr>Android-specific</nobr> code, projects, etc.
<ul>
<li><code>app</code>  
<ul>
<li><code>build.gradle</code> — This is the main build script and it’s also where you set up some application settings like version and what SDK versions to use.</li>
<li><code>libs/</code> — This is where <nobr>third-party</nobr> (Corona) <code>.jar</code> plugins that your <strong>app</strong> relies upon should go.</li>
<li><code>src</code>  
<ul>
<li><code>main</code>  
<ul>
<li><code>AndroidManifest.xml</code> — This is where you configure application settings such as name, permissions, etc.</li>
<li><code>java/</code> — This is where the Java source files for your <strong>app</strong> should go. Because the package is <code>com.mycompany.app</code>, this is where the files are located by default. You should modify this according to the package name you specify.</li>
<li><code>jniLibs/</code> — This is where <nobr>third-party</nobr> (Corona) <code>.so</code> plugins that your <strong>app</strong> relies upon should go.</li>
</ul></li>
</ul></li>
</ul></li>
<li><code>plugin</code> — This is the main folder when developing plugins for SOlar2D. All your code goes here. For <a href="../../native/plugin/index.html">plugins</a>, there are additional files and directories of interest:
<ul>
<li><code>build.gradle</code> — This is the build script that creates the plugin. The output is usually a <code>.jar</code> file. The only files included in the <code>.jar</code> are those located in <code>plugin/src/main/</code>, whether they are code or resources. In case you have additional resources to be added to the plugin (e.g., UI) that reside usually in the <code>res</code> directory (see below), an <code>aar</code> file will be generated (How to handle <code>aar</code> files please see <a href="#self-hosted">Building for Self Hosted Plugins</a>).</li>
<li><code>libs</code> — This is where <nobr>third-party</nobr> (Corona) <code>.jar</code> plugins that your <strong>plugin</strong> relies upon should go.</li>
<li><code>src</code>  
<ul>
<li><code>main</code>  
<ul>
<li><code>AndroidManifest.xml</code> — This is where you set up the plugin’s package name.</li>
<li><code>java</code>  
<ul>
<li><code>plugin</code>  
<ul>
<li><code>library</code>  
<ul>
<li><code>LuaLoader.java</code> — This is the code for the Lua library <code>plugin.library</code> on the Android side.</li>
</ul></li>
</ul></li>
</ul></li>
<li><code>jniLibs/</code> — This is where <nobr>third-party</nobr> (Corona) <code>.so</code> plugins that your <strong>plugin</strong> relies upon should go.</li>
<li><code>res/</code> — This is where your Android resources will be located (i.e., color, style, texts, and so forth). If there will be such resources remember to appy the plugin <code>'com.android.library'</code> instead of <code>'com.android.appication'</code> in your build.gradle.</li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</div>
<div class="guide-notebox">
<div class="notebox-title">
Project Flow
</div>
<p>The following steps briefly outline the flow of the <nobr><code>/Applications/Corona/Native/Project Template/App/</code></nobr> project for Android:</p>
<ol type="1">
<li><p><code>android/app/src/main/java/com/mycompany/app/CoronaApplication.java</code> — At launch time, <code>CoronaApplication.java</code> is instantiated. It adds a private class to be notified of various <nobr>app-level</nobr> events like app suspend and resume. Right before <code>main.lua</code> is invoked, the <code>onCreate()</code> method is invoked. At this point, OpenGL is set up and all Corona frameworks are available.</p></li>
<li><p><code>Corona/main.lua</code> — In the Lua code, <code>plugin.library</code> is loaded via <code>require()</code>. The Corona engine will then look for a corresponding Java class called <code>plugin.library.LuaLoader</code> and invoke it. The name of this class is dynamic and is constructed using the original library name passed to <code>require()</code> as the package name for a <code>LuaLoader</code> class. The <code>LuaLoader</code> class is expected to implement the JNLua interface <code>com.naef.jnlua.JavaFunction</code>.</p></li>
<li><p><code>android/plugin/src/main/java/plugin/library/LuaLoader.java</code> — When the <nobr>fully-qualified</nobr> class path for <code>LuaLoader</code> is resolved, the class is instantiated with the default constructor. The <code>invoke()</code> method is then called by Lua via JNLua and does all the heavy lifting, for example creating the Lua library table, registering the Lua methods like <code>show()</code>, and then leaving the table at the top of the Lua stack.</p></li>
</ol>
<div class="code-indent">
<p>Note that the <code>LuaLoader</code> class is instantiated <strong>once</strong> for the lifetime of the process, much like a <code>.dll</code> or <code>.so</code> file is typically loaded once for the lifetime of the process. Also note that the <code>invoke()</code> method is called once for each Lua state that does a <code>require()</code> — this corresponds to being called once each time the <code>CoronaActivity</code> is instantiated.</p>
</div>
</div>
<p><a id="development"></a></p>
</section>
<section id="solar2d-native-development" class="level2">
<h2>Solar2D Native Development</h2>
<section id="bridging-luajava" class="level3">
<h3>Bridging Lua/Java</h3>
<p>To bridge Lua and Java code, you’ll use functionality made available by <a href="https://code.google.com/archive/p/jnlua/">JNLua</a>. This allows you to add libraries and functions in Lua that call directly into Java.</p>
</section>
<section id="native-apis" class="level3">
<h3>Native APIs</h3>
<p>The native APIs for Android are available as a <a href="html/overview-summary.html">JavaDoc</a>.</p>
</section>
<section id="using-proguard" class="level3">
<h3>Using ProGuard</h3>
<p>Just remember to keep ProGuard from obfuscating your <code>plugin.your-plugin-name.LuaLoader</code> class by adding the line:</p>
<pre class="brush: lua;">-keep public class plugin.your-plugin-name.LuaLoader { public *;}</pre>
<p>to your <code>proguard-rules.pro</code> file within the plugin module.</p>
</section>
<section id="using-common-android-libraries" class="level3">
<h3>Using Common Android Libraries</h3>
<p>If you’re <a href="../../native/plugin/index.html">developing a plugin</a> that depends on the <a href="https://developer.android.com/topic/libraries/support-library/index.html">Android Support Libraries</a> or <a href="https://developers.google.com/android/guides/overview">Google Play Services</a>, please read our <a href="../../native/android/dependencies.html">Android Dependency Integration</a> guide.</p>
</section>
<section id="runtime-permission-support" class="level3">
<h3>Runtime Permission Support</h3>
<p>For information on working with Android Runtime Permissions in <strong>Android 6.0</strong> or newer, please read our <a href="../../native/android/permissionSupport.html">Android Runtime Permission Support</a> guide.</p>
<p><a id="building"></a></p>
</section>
</section>
<section id="building-for-devices" class="level2">
<h2>Building for Devices</h2>
<p>To build a Solar2D Native project from Android Studio, simply use the <strong>Run</strong> button on the top bar of icons. This will build your project, sign it, and prompt you to select a deployment target. The built <code>.apk</code> is signed with either a keystore you’ve specified in the <nobr><code>android</code> → <code>signingConfigs</code></nobr> block of the <code>android/app/build.gradle</code> script, or the default <code>debug.keystore</code> if none is provided.</p>
<p>Android Studio has several other <nobr>build-related</nobr> options that you can read about <a href="https://developer.android.com/studio/run">here</a>.</p>
<p><a id="self-hosted"></a></p>
</section>
<section id="building-for-self-hosted-plugins" class="level2">
<h2>Building for Self Hosted Plugins</h2>
<p>Building the plugin-in to be published on a web server (since the plugin is not yet intended to be shared with the community), a few simple extra steps are required:</p>
<ol type="1">
<li><p>Create a directory for packaging, for instance <code>package-plugin</code>. Create a folder named <code>android</code> within <code>package-plugin</code>.</p></li>
<li><p>Create a new gradle file, called <code>corona.gradle</code> and copy all your dependencies and repository definitions from your plugin’s <code>build.gradle</code> also into that file.</p></li>
<li><p>Place the <code>metadata.lua</code> file also in the directory <code>package-plugin</code></p></li>
<li><p>Use a simple packaging script to copy the build result into this directory and to call the zip/tar program. On Mac you could use the following lines, for instance, placed into a shell script <code>deploy.sh</code>:</p></li>
</ol>
<pre class="brush: lua;">#!/bin/bash
cp ../../build/outputs/aar/plugin-release.aar .
COPYFILE_DISABLE=true tar -czf ../"$(basename "$(pwd)").tgz" --exclude='.[^/]*'  ./*
scp ../android.tgz "youruser@www.your-web-server-where-plugin-will-be-hostd.de:/var/www/YOUR_DOMAIN/plugins"</pre>
<p>Finally, for those who will use your Self-Hosted-Plugin, they have to add the location (<code>www.YOUR_DOMAIN.de/plugins/android.tgz</code>) into their <code>build.settings</code> so that the build proccess for Corona-Apps can find the plugin.</p>
<hr>
<div id="footer">
<p class="copyright">
© 2020-2024 Solar2D All Rights Reserved.
</p>
<p class="feedback">
Help us help you! If you notice a problem with this page, please report it.
</p>
<p><a class="feedback-button" href="https://github.com/coronalabs/corona-docs/issues" target="_blank">Report an Issue</a></p>
</div>
</section>
</section>
<script src="https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shCore.js" type="text/javascript"></script>
<script src="https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shAutoloader.js" type="text/javascript"></script>
<script type="text/javascript">
    // Define syntax highlighting scripts.
    // N.B.: As a safeguard, you will need to whitelist the brush in filter-SyntaxHighlighter.py

    SyntaxHighlighter.autoloader(
      ['c#','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushCSharp.js'],
      ['java','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushJava.js'],
      ['js','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushJScript.js'],
      ['lua','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushLua.js'],
      ['php','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushPhp.js'],
      ['sql','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushSql.js'],
      ['xml','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushXml.js']
    );

    // Set default configurations.
    SyntaxHighlighter.defaults['gutter'] = false; // Disable line numbers.
    SyntaxHighlighter.defaults['toolbar'] = false; // Disable link back to author's site. :(
	SyntaxHighlighter.defaults['quick-code'] = false; // Disable double click feature

    // Perform the highlighting.
    SyntaxHighlighter.all();
</script>
</body>
</html>
