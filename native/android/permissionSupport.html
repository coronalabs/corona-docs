<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="https://www.w3.org/1999/xhtml">
<head>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Cousine&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="icon" type="image/ico" href="/images/favicon.ico" />
  <link rel="shortcut icon" type="image/png" href="/images/favicon.png" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title>Solar2D Documentation — Solar2D Native | Android | Runtime Permission Support</title>
  <meta name="description" content="Solar2D lets you build games/apps for all major platforms including iOS, Android, Kindle, Apple TV, Android TV, macOS, and Windows. Get the free toolset!" />
  <link rel="stylesheet" href="../../css/style.css" />
  <link rel="stylesheet" href="../../css/shCoreDefault.css" />
<script src="https://corona-cdn.coronalabs.com/js/docs.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-9574984-14', 'auto');
  ga('send', 'pageview');
</script>
</head>
<body>
<div class="header"></div>
<div class="title">
	<span class="titleimg" onclick="window.location='https://docs.coronalabs.com/'"></span>
	<div id="nav">
		<ul>
<li><a href="../../guide/programming/index.html">Getting Started</a></li>
<li><a href="../../guide/index.html">Guides</a></li>
<li><a href="../../api/index.html">API Reference</a></li>
<li><a href="../../tutorial/index.html">Tutorials</a></li>
<li><a href="../../plugin/index.html">Plugins</a></li>
<li><a href="../../native/index.html">Solar2D Native</a></li>
<li><a href="../../coronacards/index.html">CoronaCards</a></li>
</ul>

		<!--
		<div id="resources-link"><a href="https://coronalabs.com/resources/">Corona Resources</a></div>
		-->
	</div>
</div>

<div class="SearchBar">
  <form action="https://www.google.com/cse" id="cse-search-box">
  <input type="hidden" name="cx" value="009283852522218786394:g40gqt2m6rq" />
  <input type="hidden" name="ie" value="UTF-8" />
  <input type="text" placeholder="Search" name="q" id="q" autocomplete="off" size="40" />
  <input type="submit" name="sa" value="Search" />
  </form>
</div>
<div id="TOC">
<ul>
<li><a href="#android-runtime-permission-support">Android Runtime Permission Support</a><ul>
<li><a href="#about-android-runtime-permissions">About Android Runtime Permissions</a></li>
<li><a href="#targeting-android-6.0">Targeting Android 6.0</a></li>
<li><a href="#declaring-permissions">Declaring Permissions</a></li>
<li><a href="#extended-permission-apis">Extended Permission APIs</a></li>
<li><a href="#checking-for-permissions">Checking for Permissions</a></li>
<li><a href="#permission-states">Permission States</a><ul>
<li><a href="#permissionstate.granted">PermissionState.GRANTED</a></li>
<li><a href="#permissionstate.missing">PermissionState.MISSING</a></li>
<li><a href="#permissionstate.denied">PermissionState.DENIED</a></li>
</ul></li>
<li><a href="#requesting-permissions">Requesting Permissions</a><ul>
<li><a href="#using-permissions-settings">Using Permissions Settings</a></li>
<li><a href="#request-permissions-handler">Request Permissions Handler</a></li>
</ul></li>
<li><a href="#complete-example">Complete Example</a></li>
</ul></li>
</ul>
</div>
<div id="breadcrumb">
<a href="https://docs.coronalabs.com">Documentation</a>  ▸  <a href="../../native/index.html">Solar2D Native</a>  ▸  <a href="../../native/android/index.html">Android</a>  ▸  <a href="../../native/android/permissionSupport.html">Runtime Permission Support</a>
</div>
<section id="android-runtime-permission-support" class="level1">
<h1>Android Runtime Permission Support</h1>
<p>This guide explains how to add support for Android Runtime Permissions in apps/plugins built with Solar2D Native.</p>
<div class="guides-toc">
<ul>
<li><a href="#about">About Android Runtime Permissions</a></li>
<li><a href="#android-6-0">Targeting Android 6.0</a></li>
<li><a href="#declaring">Declaring Permissions</a></li>
<li><a href="#extended">Extended Permission APIs</a></li>
<li><a href="#checking">Checking for Permissions</a></li>
<li><a href="#states">Permission States</a></li>
<li><a href="#requesting">Requesting Permissions</a></li>
<li><a href="#complete-example">Complete Example</a></li>
</ul>
</div>
<p><a id="about"></a></p>
<section id="about-android-runtime-permissions" class="level2">
<h2>About Android Runtime Permissions</h2>
<p>When an Android application runs on a device, the operating system provides only limited access to resources. Before your application (or plugin) can make use of restricted resources, you must declare your intent to use them. This is done by editing your <code>AndroidManifest.xml</code> or by specifying the permissions in <code>metadata.lua</code>. See <a href="#declaring-permissions">Declaring Permissions</a> for more information.</p>
<p>For apps running on <strong>Android 5.1</strong> or lower, the <code>AndroidManifest.xml</code> file is the sole decider for what permissions are allowed, since the user approves of them when installing the app.</p>
<p>For apps running on <strong>Android 6.0</strong> or newer, the app can’t reliably assume that it has access to <a href="https://developer.android.com/guide/topics/permissions/overview#permission-groups">dangerous permissions</a>.</p>
<p>Permissions <strong>not</strong> defined in the <a href="https://developer.android.com/guide/topics/permissions/overview#permission-groups">dangerous permissions</a> table do not need to be handled at runtime, but they still need to be <a href="#declaring-permissions">declared</a>. Essentially, this means that an app/plugin can’t always assume that it has the required permissions, so it must gracefully handle the user’s rights. This guide covers how you can check for the state of permissions, request permissions, and handle the results.</p>
<div class="guide-notebox-imp">
<div class="notebox-title-imp">
Recap
</div>
<ul>
<li><p>If the device is running <strong>Android 5.1</strong> or lower, permissions are granted on app install. No runtime checks need to be performed.</p></li>
<li><p>If the device is running <strong>Android 6.0</strong> or newer, <a href="https://developer.android.com/guide/topics/permissions/overview#permission-groups">dangerous permissions</a> are requested at runtime. This requires that both the developer and the end user consider whether the permission should be granted.</p></li>
</ul>
</div>
<div class="guide-notebox">
<div class="notebox-title">
Note
</div>
<p>The Corona <a href="https://github.com/coronalabs/samples-coronasdk/blob/master/Media/Camera/main.lua">Camera</a> sample exhibits how <code>media.hasSource( media.Camera )</code> has been modified to report more information back to the user and how your project should take that information into account.</p>
</div>
<p><a id="android-6-0"></a></p>
</section>
<section id="targeting-android-6.0" class="level2">
<h2>Targeting Android 6.0</h2>
<p>To begin supporting and testing runtime permissions, you must first target Android 6.0. Simply change a number to <code>23</code> in a few places within the project (<a href="https://developer.android.com/guide/topics/manifest/uses-sdk-element.html#ApiLevels">API Level 23</a> corresponds with Android 6.0).</p>
<ol type="1">
<li><p><code>AndroidManifest.xml</code> — Change <code>android:targetSdkVersion="xx"</code> to <code>android:targetSdkVersion="23"</code>. This will allow you to test your changes in the local project.</p></li>
<li><p><code>project.properties</code> — Change <nobr><code>target=Google Inc.:Google APIs:xx</code></nobr> to <nobr><code>target=Google Inc.:Google APIs:23</code></nobr>. Like above, this is for testing your changes.</p></li>
<li><p><code>project.plugin.properties</code> — For <nobr>natively-developed</nobr> plugins, change the line <code>target=android-xx</code> to <code>target=android-23</code>. This change will affect the plugin itself.</p></li>
</ol>
<p><a id="declaring"></a></p>
</section>
<section id="declaring-permissions" class="level2">
<h2>Declaring Permissions</h2>
<p>Once it has been determined which permissions the app/plugin requires, declaration is handled as follows:</p>
<ul>
<li><p>If you are developing a native plugin, you must declare permissions within <code>metadata.lua</code>. This ensures that the permissions are automatically imported for Solar2D users.</p>
<p>For example, if the <code>android.permission.SEND_SMS</code> permission is required, the <code>usesPermissions</code> table must contain it like this:</p></li>
</ul>
<div class="code-indent">
<pre class="brush: lua;">local metadata =
{
    plugin =
    {
        manifest =
        {
            usesPermissions =
            {
                "android.permission.SEND_SMS",
            },
        },
    },
}
return metadata</pre>
<div class="guide-notebox-imp">
<div class="notebox-title-imp">
Important
</div>
<p>In addition, for Solar2D Native developers, you should communicate that these permissions must be explicitly added to their <code>AndroidManifest.xml</code> file <nobr>(see next point)</nobr>.</p>
</div>
</div>
<ul>
<li><p>Solar2D Native users must add permissions to <code>AndroidManifest.xml</code> explicitly.</p>
<p>For example, if the <code>android.permission.SEND_SMS</code> permission is required, the <code>AndroidManifest.xml</code> must contain it like this:</p></li>
</ul>
<div class="code-indent">
<pre class="brush: xml;">&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android" package="com.example.snazzyapp">

    &lt;uses-permission android:name="android.permission.SEND_SMS"/>

&lt;/manifest></pre>
</div>
<p><a id="extended"></a></p>
</section>
<section id="extended-permission-apis" class="level2">
<h2>Extended Permission APIs</h2>
<p>Supporting runtime permissions in Corona is very similar to supporting them in native Android apps. This guide is intended as a supplement to Google’s <a href="https://developer.android.com/training/permissions/requesting.html">Requesting Permissions at Run Time</a> guide and follows along in parallel with it.</p>
<p>In Corona, we have provided an interface for developers to handle their permission requests without having to worry about API Levels or <a href="https://www.owasp.org/images/c/ca/ASDC12-An_InDepth_Introduction_to_the_Android_Permissions_Modeland_How_to_Secure_MultiComponent_Applications.pdf#page=11">permission leak</a>.</p>
<p>The majority of the functionality you’ll need comes from our <code>com.ansca.corona.permissions.PermissionsServices</code> class. This provides several APIs intended to bridge Google’s permission handling with the <nobr>cross-platform</nobr> manner that Corona handles permissions. It also provides <nobr>easy-to-use</nobr> APIs for gathering information about the state of the <code>AndroidManifest.xml</code> file, as well as the state of various permissions.</p>
<p>See <a href="#permission-checking">Checking for Permissions</a> and <a href="#permission-requesting">Requesting Permissions</a> below for details.</p>
<p><a id="checking"></a></p>
</section>
<section id="checking-for-permissions" class="level2">
<h2>Checking for Permissions</h2>
<p>This can be done via Google’s <a href="https://developer.android.com/reference/android/content/Context.html#checkSelfPermission%28java.lang.String%29">context.checkSelfPermission()</a> API, however it’s only available in API Level 23, it doesn’t protect against <a href="https://www.owasp.org/images/c/ca/ASDC12-An_InDepth_Introduction_to_the_Android_Permissions_Modeland_How_to_Secure_MultiComponent_Applications.pdf#page=11">permission leak</a>, and it ignores instances when a permission is not listed in <code>AndroidManifest.xml</code>. Instead, we recommend checking for permissions using Corona’s <code>PermissionsServices.getPermissionStateFor()</code><!-- (TODO: LINK) --> API. This provides the state of a permission on all supported Android versions and can also determine if the desired permission is missing from <code>AndroidManifest.xml</code>.</p>
<pre class="brush: java;">// Determine the PermissionState for the our ability to send SMS messages.
PermissionsServices permissionsServices = new PermissionsServices(CoronaEnvironment.getApplicationContext());
PermissionState sendSMSState = permissionsServices.getPermissionStateFor(PermissionsServices.Permission.SEND_SMS);</pre>
<p>Here, we use a <code>PermissionsServices</code> instance to query the state of the <code>SEND.SMS</code> permission. If we get <code>PermissionState.GRANTED</code> back, we know that we’re able to continue to call code which requires this permission.</p>
<p><a id="states"></a></p>
</section>
<section id="permission-states" class="level2">
<h2>Permission States</h2>
<p><code>PermissionsServices.getPermissionStateFor()</code> returns a <code>PermissionState</code> enum with one of the following values. It’s important that your app/plugin can handle each one of these possible permission states without crashing or getting into a bad state.</p>
<section id="permissionstate.granted" class="level3">
<h3>PermissionState.GRANTED</h3>
<p>This permission has been granted by the user. Corresponds to Google’s <code>android.content.pm.PackageManager.PERMISSION_GRANTED</code>. When a permission is in this state, you’re permitted to do whatever necessary that requires the permission.</p>
</section>
<section id="permissionstate.missing" class="level3">
<h3>PermissionState.MISSING</h3>
<p>This permission isn’t listed in the app’s <code>AndroidManifest.xml</code> file. If a permission is in this state, one of the following scenarios may apply:</p>
<ul>
<li>For native plugins, <code>metadata.lua</code> may not have specified the permission as being required.</li>
<li>The permission was intentionally omitted because because it shouldn’t be used.</li>
</ul>
<p>The context in which you handle <code>PermissionState.MISSING</code> depends on whether the specific permission is mandatory for core functionality or whether it’s merely associated with a <nobr>non-critical</nobr> feature. For example, a QR scanner plugin absolutely requires the <code>Camera</code> permission to function and, if the <code>Camera</code> permission state is <code>PermissionState.MISSING</code>, you should alert the developer that they must add this to their <code>AndroidManifest.xml</code> file. Corona’s <code>PermissionsServices.showMissingFromManifestAlert()</code> API makes this easy:</p>
<pre class="brush: java;">// Display a "missing from manifest" alert
PermissionsServices permissionsServices = new PermissionsServices(CoronaEnvironment.getApplicationContext());
permissionsServices.showPermissionMissingFromManifestAlert(PermissionsServices.Permission.CAMERA, "The &lt;Super Cool QR Scanner Plugin> requires access to the device's camera(s)!");</pre>
</section>
<section id="permissionstate.denied" class="level3">
<h3>PermissionState.DENIED</h3>
<p>This permission has either been explicitly denied, or has not yet been requested. Corresponds to Google’s <code>android.content.pm.PackageManager.PERMISSION_DENIED</code>.</p>
<p>If a permission is in this state, it means that the permission is specified in the project’s <code>AndroidManifest.xml</code> file, but the Android OS has denied the app access to it. At this point, you should check whether the user still wants requests for the permission via <code>PermissionsServices.shouldNeverAskAgain()</code> <!-- TODO: LINK -->. Assuming the user still wants requests for this permission, the app should now <a href="#permission-requesting">request access</a> to the denied permission.</p>
<pre class="brush: java;">// Request permission to use external storage
PermissionsServices permissionsServices = new PermissionsServices(CoronaEnvironment.getApplicationContext());
if (!permissionsServices.shouldNeverAskAgain(PermissionsServices.Permission.WRITE_EXTERNAL_STORAGE)) {
    // Request Write External Storage permission. We cover how to do this in the section below
}</pre>
<p>When everything is put together, the code to check for a permission state and handle all possible outcomes will typically contain this template:</p>
<pre class="brush: java;">// Only do our dangerous work if we have permission to use external storage
PermissionsServices permissionsServices = new PermissionsServices(CoronaEnvironment.getApplicationContext());
PermissionState writeExternalStoragePermissionState = permissionsServices.getPermissionStateFor(PermissionsServices.Permission.WRITE_EXTERNAL_STORAGE);
switch(writeExternalStoragePermissionState) {
    case MISSING:
        // The Corona developer forgot or refused to add the permission to the AndroidManifest.xml
        break;
    case DENIED:
        // Check PermissionsServices.shouldNeverAskAgain() and try to request permission
        break;
    default:
        // Permission is granted; continue as usual
        doDangerousWork();
}</pre>
<p><a id="requesting"></a></p>
</section>
</section>
<section id="requesting-permissions" class="level2">
<h2>Requesting Permissions</h2>
<p>Now that you know how to determine the state of a permission, you’ll need to request required permissions using <code>permissionsServices.requestPermissions()</code>. Read further to learn about <code>PermissionsSettings</code> and <code>OnRequestPermissionsHandler</code>.</p>
<div class="guide-notebox-imp">
<div class="notebox-title-imp">
Important
</div>
<p>Calling <code>PermissionsServices.requestPermissions()</code> is asynchronous and it will temporarily suspend the user’s application while presenting the permission UI to the user. The response will be on the main UI thread, not on the Lua thread. Be sure to use a <code>CoronaRuntimeTaskDispatcher</code> if necessary.</p>
</div>
<section id="using-permissions-settings" class="level3">
<h3>Using Permissions Settings</h3>
<p>A <code>PermissionsSettings</code> object is used to define the permissions you want to request. For example, you can request a single permission:</p>
<pre class="brush: java;">// Define that we will request permission to write to external storage
PermissionsSettings settings = new PermissionsSettings(PermissionsServices.Permission.WRITE_EXTERNAL_STORAGE);

PermissionsServices permissionsServices = new PermissionsServices(CoronaEnvironment.getApplicationContext());
permissionsServices.requestPermissions(settings, MyOnRequestPermissionsHandler);</pre>
<p>Or, you can request multiple permissions:</p>
<pre class="brush: java;">// Define that we will request permission to write to external storage and access the camera
PermissionsSettings settings = new PermissionsSettings(new String[] {PermissionsServices.Permission.WRITE_EXTERNAL_STORAGE, PermissionsServices.Permission.CAMERA});

PermissionsServices permissionsServices = new PermissionsServices(CoronaEnvironment.getApplicationContext());
permissionsServices.requestPermissions(settings, MyOnRequestPermissionsHandler);</pre>
<p>In both of these examples, <code>MyOnRequestPermissionsHandler</code> is an implementation of the <code>OnRequestPermissionsHandler</code>. Learn more about this in the next section.</p>
</section>
<section id="request-permissions-handler" class="level3">
<h3>Request Permissions Handler</h3>
<p>As <code>PermissionsServices.requestPermissions()</code> is asynchronous, a callback is required to indicate when the user has finished denying or granting the requested permissions. This is done through the <code>CoronaActivity.OnRequestPermissionsResultHandler</code> interface. When the user is finished, the <code>onHandleRequestPermissionsResult</code> method from this interface will be called.</p>
<p>Here is a basic implementation:</p>
<pre class="brush: java;">private class MyRequestPermissionsResultHandler implements CoronaActivity.OnRequestPermissionsResultHandler {
    @Override
    public void onHandleRequestPermissionsResult(CoronaActivity activity, int requestCode, String[] permissions, int[] grantResults) {
        // Clean up and unregister our request (you should always do this)
        PermissionsSettings permissionsSettings = activity.unregisterRequestPermissionsResultHandler(this);
        if (permissionsSettings != null) {
            permissionsSettings.markAsServiced();
        }

        // Use PermissionServices to ensure that we have permission to write to external storage
        PermissionsServices permissionsServices = new PermissionsServices(activity);
        if (permissionsServices.getPermissionStateFor(PermissionsServices.Permission.WRITE_EXTERNAL_STORAGE) == PermissionState.GRANTED) {
            // Handle the case where our permission was granted
        } else {
            // Handle the case where our permissions were not granted
        }
    }
}</pre>
<p>You can then use the <code>OnRequestPermissionsResultHandler</code> as follows:</p>
<pre class="brush: java;">PermissionsSettings settings = new PermissionsSettings(PermissionsServices.Permission.WRITE_EXTERNAL_STORAGE);
MyRequestPermissionsResultHandler handler = new MyRequestPermissionsResultHandler()

PermissionsServices permissionsServices = new PermissionsServices(CoronaEnvironment.getApplicationContext());
permissionsServices.requestPermissions(settings, handler);</pre>
<p><a id="complete-example"></a></p>
</section>
</section>
<section id="complete-example" class="level2">
<h2>Complete Example</h2>
<p>Putting this together, we can write a class that implements <code>CoronaActivity.OnRequestPermissionsResultHandler</code> and handles permissions for us. The implementation may look like this:</p>
<pre class="brush: java;">private class MyFileIOFunctionRequestPermissionsResultHandler implements CoronaActivity.OnRequestPermissionsResultHandler {
    public void handleRun() {
        // Check for WRITE_EXTERNAL_STORAGE permission
        PermissionsServices permissionsServices = new PermissionsServices(CoronaEnvironment.getApplicationContext());
        PermissionState writeExternalStoragePermissionState = permissionsServices.getPermissionStateFor(PermissionsServices.Permission.WRITE_EXTERNAL_STORAGE);
        switch(writeExternalStoragePermissionState) {
            case MISSING:
                // The Corona developer didn't add the permission to the AndroidManifest.xml
                // As it is required for our app to function, we'll error out here
                // If the permission were not critical, we could work around it here
                permissionsServices.showPermissionMissingFromManifestAlert(PermissionsServices.Permission.WRITE_EXTERNAL_STORAGE, "My plugin requires access to the device's storage!");
                break;
            case DENIED:
                if (!permissionsServices.shouldNeverAskAgain(PermissionsServices.Permission.WRITE_EXTERNAL_STORAGE)) {
                    // Create our Permissions Settings to compare against in the handler
                    PermissionsSettings settings = new PermissionsSettings(PermissionsServices.Permission.WRITE_EXTERNAL_STORAGE);

                    // Request Write External Storage permission
                    permissionsServices.requestPermissions(settings, this);
                }
                break;
            default:
                // Permission is granted!
                run();
        }
    }

    @Override
    public void onHandleRequestPermissionsResult(CoronaActivity activity, int requestCode, String[] permissions, int[] grantResults) {
        // Clean up and unregister our request (you should always do this)
        PermissionsSettings permissionsSettings = activity.unregisterRequestPermissionsResultHandler(this);
        if (permissionsSettings != null) {
            permissionsSettings.markAsServiced();
        }

        // Check for WRITE_EXTERNAL_STORAGE permission
        PermissionsServices permissionsServices = new PermissionsServices(activity);
        if (permissionsServices.getPermissionStateFor(PermissionsServices.Permission.WRITE_EXTERNAL_STORAGE) == PermissionState.GRANTED) {
            run();
        } else {
            // We were denied permission
        }
    }

    public void run() {
        // We are sure we have the required permissions; write to storage!
    }</pre>
<p>We’d move our dangerous code into the <code>run()</code> function above. The exposed Lua function may then look like this:</p>
<pre class="brush: java;">private class MyFileIOFunction implements NamedJavaFunction {
    @Override
    public String getName() {
        // e.g. "myPlugin.doSomethingWithExternalStorage()"
        return "doSomethingWithExternalStorage";
    }

    @Override
    public int invoke(LuaState L) {
        // NOTE: RequestPermissionsResultHandlers are NOT guaranteed to be synchronous. Here we have two different behaviors:
        // 1) If the permission is already granted, or we are on Android version &lt; 6.0, we return immediately on the lua
        //    thread with no interruption
        // 2) If the permission needs the user to approve it (Android 6.0+), we wait and handle the request later; this must
        //    be dispatched to run on the lua thread, not the main or UI thread
        // Be sure to use a CoronaRuntimeTask if needed!
        MyFileIOFunctionRequestPermissionsResultHandler resultHandler = new MyFileIOFunctionRequestPermissionsResultHandler(L);
        resultHandler.handleRun();
        return 0;
    }
}</pre>
<p>It’s important to note that the <code>OnRequestPermissionsResultHandler</code> is <strong>not</strong> guaranteed to be synchronous. Checking the code above, we see that there are two different ways to call <code>run()</code>:</p>
<ol type="1">
<li><p>We already have the permission granted (perhaps because we’re not on Android 6.0+ and we simply defined the permission in <code>AndroidManifest.xml</code>). In this case, we call <code>run()</code> from the Lua thread, synchronously.</p></li>
<li><p>The app does not have permission, so we request permission. This causes the app to suspend, displaying a UI prompting the user to accept or deny the permission request. The result of this interaction is sent to <code>OnRequestPermissionsResultHandler.onHandleRequestPermissionsResult()</code> on the main UI thread. A <code>CoronaRuntimeTaskDispatcher</code> should be used to ensure that we interact with Lua at the proper time (see below).</p></li>
</ol>
<pre class="brush: java;">private void run() {
    // This function can be called from either the main thread, or the Lua thread; safely dispatch it
    // Note that we'll need to store the lua state we want to dispatch to elsewhere
    final CoronaRuntimeTaskDispatcher dispatcher = new CoronaRuntimeTaskDispatcher(fLuaState);
    dispatcher.send( new CoronaRuntimeTask() {
            @Override
            public void executeUsing(CoronaRuntime runtime) {
                LuaState L = runtime.getLuaState();

                // ...
            }
        } );</pre>
<hr>
<div id="footer">
<p class="copyright">
© 2020-2024 Solar2D All Rights Reserved.
</p>
<p class="feedback">
Help us help you! If you notice a problem with this page, please report it.
</p>
<p><a class="feedback-button" href="https://github.com/coronalabs/corona-docs/issues" target="_blank">Report an Issue</a></p>
</div>
</section>
</section>
<script src="https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shCore.js" type="text/javascript"></script>
<script src="https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shAutoloader.js" type="text/javascript"></script>
<script type="text/javascript">
    // Define syntax highlighting scripts.
    // N.B.: As a safeguard, you will need to whitelist the brush in filter-SyntaxHighlighter.py

    SyntaxHighlighter.autoloader(
      ['c#','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushCSharp.js'],
      ['java','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushJava.js'],
      ['js','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushJScript.js'],
      ['lua','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushLua.js'],
      ['php','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushPhp.js'],
      ['sql','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushSql.js'],
      ['xml','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushXml.js']
    );

    // Set default configurations.
    SyntaxHighlighter.defaults['gutter'] = false; // Disable line numbers.
    SyntaxHighlighter.defaults['toolbar'] = false; // Disable link back to author's site. :(
	SyntaxHighlighter.defaults['quick-code'] = false; // Disable double click feature

    // Perform the highlighting.
    SyntaxHighlighter.all();
</script>
</body>
</html>
