<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="https://www.w3.org/1999/xhtml">
<head>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Cousine&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="icon" type="image/ico" href="/images/favicon.ico" />
  <link rel="shortcut icon" type="image/png" href="/images/favicon.png" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title>Solar2D Documentation — Tutorials | Basics</title>
  <meta name="description" content="Solar2D lets you build games/apps for all major platforms including iOS, Android, Kindle, Apple TV, Android TV, macOS, and Windows. Get the free toolset!" />
  <link rel="stylesheet" href="../../../css/style.css" />
  <link rel="stylesheet" href="../../../css/shCoreDefault.css" />
<script src="https://corona-cdn.coronalabs.com/js/docs.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-9574984-14', 'auto');
  ga('send', 'pageview');
</script>
</head>
<body>
<div class="header"></div>
<div class="title">
	<span class="titleimg" onclick="window.location='https://docs.coronalabs.com/'"></span>
	<div id="nav">
		<ul>
<li><a href="../../../guide/programming/index.html">Getting Started</a></li>
<li><a href="../../../guide/index.html">Guides</a></li>
<li><a href="../../../api/index.html">API Reference</a></li>
<li><a href="../../../tutorial/index.html">Tutorials</a></li>
<li><a href="../../../plugin/index.html">Plugins</a></li>
<li><a href="../../../native/index.html">Solar2D Native</a></li>
<li><a href="../../../coronacards/index.html">CoronaCards</a></li>
</ul>

		<!--
		<div id="resources-link"><a href="https://coronalabs.com/resources/">Corona Resources</a></div>
		-->
	</div>
</div>

<div class="SearchBar">
  <form action="https://www.google.com/cse" id="cse-search-box">
  <input type="hidden" name="cx" value="009283852522218786394:g40gqt2m6rq" />
  <input type="hidden" name="ie" value="UTF-8" />
  <input type="text" placeholder="Search" name="q" id="q" autocomplete="off" size="40" />
  <input type="submit" name="sa" value="Search" />
  </form>
</div>
<div id="TOC">
<ul>
<li><a href="#using-external-modules">Using External Modules</a><ul>
<li><a href="#including-external-modules">Including External Modules</a></li>
<li><a href="#the-package.loaded-table">The “package.loaded” Table</a></li>
<li><a href="#executing-module-code">Executing Module Code</a></li>
<li><a href="#removing-modules">Removing Modules</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul></li>
</ul>
</div>
<div id="breadcrumb">
<a href="https://docs.coronalabs.com">Documentation</a>  ▸  <a href="../../../tutorial/index.html">Tutorials</a>  ▸  <a href="../../../tutorial/basics/index.html">Basics</a>
</div>
<section id="using-external-modules" class="level1">
<h1>Using External Modules</h1>
<p>There’s often confusion as to what exactly happens when external modules are “required” into your code, which leads to further confusion and unexpected behavior when it comes to things such as Composer scenes or even custom modules of your own.</p>
<p>This tutorial will guide you through a series of exercises (with explanations) that should illustrate exactly how modules work in Lua, so you get a full understanding of when (and which) code in your modules is executed.</p>
<section id="including-external-modules" class="level2">
<h2>Including External Modules</h2>
<p>In its simplest form, an <strong>external module</strong> is simply a Lua file that returns something, most likely a table. It can almost be thought of as a function definition, but it’s contained in a file all to itself.</p>
<p>Here’s a really simple module, <code>example1.lua</code>, which simply prints a statement to the console and returns an empty table:</p>
<pre class="brush: lua;">-- example1.lua
 
local M = {}

print( "example1.lua has been loaded" )

return M</pre>
<p>Now, in a different module — let’s just use <code>main.lua</code> — require the <code>example1.lua</code> module and see what happens (note that all code examples in this tutorial assume that the custom external modules are placed in the root level of your project folder, alongside <code>main.lua</code>).</p>
<pre class="brush: lua;">-- main.lua
 
local ex1 = require( "example1" )

ex1.testvar = "Hello World!"</pre>
<p>As expected, upon execution of the first command, the variable <code>ex1</code> becomes equal to the empty table (<code>M</code>) which we created and returned in <code>example1.lua</code>, and the words <nobr><code>example1.lua has been loaded</code></nobr> appear in the console.</p>
<p>In the next command, we assign a trivial property, <code>testvar</code>, to this <code>ex1</code> table.</p>
<p>Pay close attention now since this gets more tricky. Let’s require <code>example1.lua</code> in an <strong>another</strong> module, <code>scene1.lua</code>, <strong>after</strong> we have already required it within <code>main.lua</code>:</p>
<pre class="brush: lua;">-- scene1.lua (previous "main.lua" still applies)

local examp1 = require( "example1" )

print( examp1.testvar )</pre>
<p>This time — in <code>scene1.lua</code> — when you require the <code>example1.lua</code> module, the words <nobr><code>example1.lua has been loaded</code></nobr> do <strong>not</strong> appear in the console. However, when you print the value of <code>examp1.testvar</code>, <nobr><code>Hello World!</code></nobr> is output which means that the <code>testvar</code> property exists! What can we learn from this? Read on…</p>
</section>
<section id="the-package.loaded-table" class="level2">
<h2>The “package.loaded” Table</h2>
<p>The reason why <nobr><code>example1.lua has been loaded</code></nobr> did <strong>not</strong> appear in the console is because the module was <strong>already loaded</strong> by <code>main.lua</code>. Essentially, when a module is loaded (required), its code is executed from top to bottom as usual, and the return value of the module is stored in a global table called <code>package.loaded</code>. From that point on, the module is considered “loaded” and it can’t simply be <nobr>re-loaded</nobr> fresh by requiring it again.</p>
<p>Let’s explore this in a bit more detail:</p>
<ul>
<li><p>When you call <code>require()</code>, the first thing that happens is the <code>package.loaded</code> table is checked to see if the module was previously loaded.</p></li>
<li><p>If it <strong>is</strong> found, then instead of <nobr>re-requiring</nobr> the external module, the stored return value in <code>package.loaded</code> is returned. In other words, this returned value is a <strong>reference</strong>, not a copy. Thus, if your module returns a table, that’s the same table you’ll get (properties and all) when you call <code>require()</code> on the same module in the future.</p></li>
<li><p>If the module is <strong>not</strong> found in <code>package.loaded</code>, the module will be loaded, the code will run from top to bottom, and the return value of the module will be stored in the <code>package.loaded</code> table for any future requires of the module. This explains why <nobr><code>example1.lua has been loaded</code></nobr> was <strong>not</strong> shown again — because <code>example1.lua</code> was already required within <code>main.lua</code>, it is not <nobr>re-loaded</nobr> in <code>scene1.lua</code>.</p></li>
</ul>
</section>
<section id="executing-module-code" class="level2">
<h2>Executing Module Code</h2>
<p>There are two ways to get code within a module to run:</p>
<ol type="1">
<li><p>Put the code inside a function (within the module) and call it like a normal function.</p></li>
<li><p>Remove the module from the <code>package.loaded</code> table and <nobr>re-require</nobr> it (generally not recommended).</p></li>
</ol>
<p>Here’s an example of the first scenario:</p>
<pre class="brush: lua;">-- example2.lua
 
local M = {}

print( "example2.lua has been loaded" )
 
M.hello = function()
    print( "Hello World!" )
end

return M</pre>
<pre class="brush: lua;">-- main.lua

local ex2 = require( "example2" )  --> example2.lua has been loaded

ex2.hello()  --> Hello World!</pre>
<pre class="brush: lua;">-- scene1.lua

local examp2 = require( "example2" )

examp2.hello()  --> Hello World!</pre>
<p>As you can see, we required <code>example2.lua</code> in two different modules, <code>main.lua</code> and <code>scene1.lua</code>. The first <code>print()</code> statement — the one outside of any functions — occurs only once (the first time the module is required within <code>main.lua</code>). In contrast, the second <code>print()</code> statement — the one within the <code>M.hello</code> function — is executed each time that function is called.</p>
<p>What is the lesson learned? Essentially, if you want to run code within a module more than once, or if you don’t want to run it immediately upon requiring the module, you should wrap it within a function and “attach” the function to the table which you return at the end of the module.</p>
<div class="guide-notebox-imp">
<div class="notebox-title-imp">
Important
</div>
<p>Properly “attaching” module functions to the returned table is essential to gain access to them. You can not simply include the function within the module as a local function and then expect access to it from another module. Notice the difference:</p>
<pre class="brush: lua;">local M = {}
 
-- This function WILL be accessible outside of this module, wherever the module is required
M.hello = function()
    print( "Hello World!" )
end

-- This function will NOT be accessible outside of this module, only within it locally
local hello = function()
    print( "Hello World!" )
end

return M</pre>
</div>
</section>
<section id="removing-modules" class="level2">
<h2>Removing Modules</h2>
<p>As outlined above, you require a module like <code>example2.lua</code> using the following syntax:</p>
<pre class="brush: lua;">local ex2 = require( "example2" )</pre>
<p>With this, the return value of <code>example2.lua</code> is effectively stored in the <code>package.loaded</code> table under:</p>
<pre class="brush: lua;">package.loaded["example2"]</pre>
<p>Thus, if you want to <nobr>“un-require”</nobr> a module and clear it from memory entirely, simply assign <code>nil</code> to this reference as follows:</p>
<pre class="brush: lua;">package.loaded["example2"] = nil</pre>
<p>At this point, the module will be cleared from memory and all of its associated function(s) will cease to exist.</p>
</section>
<section id="conclusion" class="level2">
<h2>Conclusion</h2>
<p>Hopefully this tutorial has given you a solid foundational understanding of Lua modules, how to include them, and how to call functions that exist in one module from another module. Conveniently, these rules are universal and apply to any module you may be dealing with, whether it’s your own <nobr>custom-made</nobr> module, a module you downloaded, or even <nobr>built-in</nobr> Solar2D modules.</p>
<hr>
<div id="footer">
<p class="copyright">
© 2020-2024 Solar2D All Rights Reserved.
</p>
<p class="feedback">
Help us help you! If you notice a problem with this page, please report it.
</p>
<p><a class="feedback-button" href="https://github.com/coronalabs/corona-docs/issues" target="_blank">Report an Issue</a></p>
</div>
</section>
</section>
<script src="https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shCore.js" type="text/javascript"></script>
<script src="https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shAutoloader.js" type="text/javascript"></script>
<script type="text/javascript">
    // Define syntax highlighting scripts.
    // N.B.: As a safeguard, you will need to whitelist the brush in filter-SyntaxHighlighter.py

    SyntaxHighlighter.autoloader(
      ['c#','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushCSharp.js'],
      ['java','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushJava.js'],
      ['js','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushJScript.js'],
      ['lua','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushLua.js'],
      ['php','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushPhp.js'],
      ['sql','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushSql.js'],
      ['xml','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushXml.js']
    );

    // Set default configurations.
    SyntaxHighlighter.defaults['gutter'] = false; // Disable line numbers.
    SyntaxHighlighter.defaults['toolbar'] = false; // Disable link back to author's site. :(
	SyntaxHighlighter.defaults['quick-code'] = false; // Disable double click feature

    // Perform the highlighting.
    SyntaxHighlighter.all();
</script>
</body>
</html>
