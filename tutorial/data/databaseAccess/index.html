<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="https://www.w3.org/1999/xhtml">
<head>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Cousine&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="icon" type="image/ico" href="/images/favicon.ico" />
  <link rel="shortcut icon" type="image/png" href="/images/favicon.png" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title>Solar2D Documentation — Tutorials | Data/Files/Strings</title>
  <meta name="description" content="Solar2D lets you build games/apps for all major platforms including iOS, Android, Kindle, Apple TV, Android TV, macOS, and Windows. Get the free toolset!" />
  <link rel="stylesheet" href="../../../css/style.css" />
  <link rel="stylesheet" href="../../../css/shCoreDefault.css" />
<script src="https://corona-cdn.coronalabs.com/js/docs.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-9574984-14', 'auto');
  ga('send', 'pageview');
</script>
</head>
<body>
<div class="header"></div>
<div class="title">
	<span class="titleimg" onclick="window.location='https://docs.coronalabs.com/'"></span>
	<div id="nav">
		<ul>
<li><a href="../../../guide/programming/index.html">Getting Started</a></li>
<li><a href="../../../guide/index.html">Guides</a></li>
<li><a href="../../../api/index.html">API Reference</a></li>
<li><a href="../../../tutorial/index.html">Tutorials</a></li>
<li><a href="../../../plugin/index.html">Plugins</a></li>
<li><a href="../../../native/index.html">Solar2D Native</a></li>
<li><a href="../../../coronacards/index.html">CoronaCards</a></li>
</ul>

		<!--
		<div id="resources-link"><a href="https://coronalabs.com/resources/">Corona Resources</a></div>
		-->
	</div>
</div>

<div class="SearchBar">
  <form action="https://www.google.com/cse" id="cse-search-box">
  <input type="hidden" name="cx" value="009283852522218786394:g40gqt2m6rq" />
  <input type="hidden" name="ie" value="UTF-8" />
  <input type="text" placeholder="Search" name="q" id="q" autocomplete="off" size="40" />
  <input type="submit" name="sa" value="Search" />
  </form>
</div>
<div id="TOC">
<ul>
<li><a href="#database-access-using-sqlite">Database Access Using SQLite</a><ul>
<li><a href="#creating-a-database">Creating a Database</a></li>
<li><a href="#creating-a-table">Creating a Table</a></li>
<li><a href="#creating-new-rows">Creating New Rows</a></li>
<li><a href="#lua-table-to-sql-table">Lua Table to SQL Table</a></li>
<li><a href="#updating-existing-rows">Updating Existing Rows</a></li>
<li><a href="#deleting-a-row">Deleting a Row</a></li>
<li><a href="#retrieving-data">Retrieving Data</a></li>
<li><a href="#closing-the-database">Closing the Database</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul></li>
</ul>
</div>
<div id="breadcrumb">
<a href="https://docs.coronalabs.com">Documentation</a>  ▸  <a href="../../../tutorial/index.html">Tutorials</a>  ▸  <a href="../../../tutorial/data/index.html">Data/Files/Strings</a>
</div>
<section id="database-access-using-sqlite" class="level1">
<h1>Database Access Using SQLite</h1>
<p>The topic of databases is <nobr>far-reaching</nobr> in the world of programming, especially for web developers, and for good reason. Databases are great for storing and organizing a lot of information, and when it comes to retrieving that data for later use, there’s rarely a better option.</p>
<p>For instance, if you are writing a “notes” app, you should ideally store the user’s individual notes in a database. Sure, you could just store each note as a separate text file, but then you’d potentially have a large number of files to deal with separately, versus a consolidated database file. An even bigger hindrance would be that tasks such as sorting and searching — both commonplace in the world of databases — would be nearly impossible.</p>
<p>In this tutorial, we’ll walk through creating a database, saving it to a file, storing information, and retrieving that data for use in a Corona app.</p>
<div class="guide-notebox">
<div class="notebox-title">
What About JSON?
</div>
<p>Developers familiar with <a href="../../../api/library/json/index.html">JSON</a> know that it’s great for storing similar types of information easily, because a decoded JSON string in Corona comes back as a Lua table. So why would you use JSON in favor of a database or <nobr>vice-versa?</nobr> Both are powerful tools, but they have key differences which should be leveraged depending on the needs of your app — in other words, let the best tool for the job win!</p>
<p>A basic rule of thumb when deciding which one to use is, if it’s a large amount of data — and especially if the data needs to be searched or sorted — a database is the clear winner every time. However, for smaller sets of data such as tables that store configuration data, JSON wins because of its simplicity.</p>
<p>For more details on saving and loading data in JSON format, please see the <a href="../../../tutorial/data/jsonSaveLoad/index.html">Saving/Loading Tables Using JSON</a> tutorial.</p>
</div>
<section id="creating-a-database" class="level2">
<h2>Creating a Database</h2>
<p>There are two ways you can go about creating a SQLite database:</p>
<ol type="1">
<li>Create an <nobr>in-memory</nobr> database with a lifespan that only extends as far as the runtime of the app.</li>
<li>Create a database file that can be stored and accessed at any time.</li>
</ol>
<p>Since you almost certainly want to store data for future access, this tutorial will only discuss the second method.</p>
<p>This example shows how to open a saved database file and/or create a database file that does not yet exist:</p>
<pre class="brush: lua;">-- Require the SQLite library
local sqlite3 = require( "sqlite3" )

-- Create a file path for the database file "data.db"
local path = system.pathForFile( "data.db", system.DocumentsDirectory )

-- Open the database for access
local db = sqlite3.open( path )</pre>
<div class="docs-tip-outer">
<div class="docs-tip-inner-left">
<div class="fa fa-cog">

</div>
</div>
<div class="docs-tip-inner-right">
<p>Note that the recommended location for creating a database is <code>system.DocumentsDirectory</code>, as shown in this example. Your project resource directory cannot be written to, and the temporary/cache directories are periodically wiped clean by the OS, so using the documents directory will ensure that you’re able to read/write from/to your database and that it resides in a safe, persistent location.</p>
</div>
</div>
</section>
<section id="creating-a-table" class="level2">
<h2>Creating a Table</h2>
<p>Some common terms you’ll hear when working with SQLite databases include <strong>tables</strong> (not Lua tables, but SQL tables), <strong>columns</strong>, and <strong>rows</strong>. Basically, SQL <strong>tables</strong> can be thought of as “categories” of data. Each table, in turn, can have multiple <strong>columns</strong> which can be thought of as “properties” of the table, for example <code>UserID</code>, <code>FirstName</code>, <code>LastName</code>, etc. Finally, the individual “records” which are inserted into tables are known as <strong>rows</strong>.</p>
<p>Rows — and more specifically their properties — are the actual data you’ll most commonly be working with, but before we can add rows, we must set up a table with specific columns:</p>
<pre class="brush: lua;">local tableSetup = [[CREATE TABLE IF NOT EXISTS test ( UserID INTEGER PRIMARY KEY autoincrement, FirstName, LastName );]]
db:exec( tableSetup )</pre>
<p>In the above code, <code>tableSetup</code> is a string that represents an <strong>SQL query</strong> — basically, a command that tells the database what to do. In this case, we will create a <strong>table</strong> called <code>test</code> with three <strong>columns</strong>:</p>
<ol type="1">
<li><code>UserID</code></li>
<li><code>FirstName</code></li>
<li><code>LastName</code></li>
</ol>
<p>Following that, we simply “execute” the query on the database object we created above (<code>db</code>).</p>
<div class="guide-notebox-imp">
<div class="notebox-title-imp">
Important
</div>
<ul>
<li><p>The first column in a table is usually an “ID” column that is set to be an <nobr>auto-incrementing</nobr> <strong>primary key</strong>. This is an extremely important column in almost every database table because it provides you with a permanent, unique identification value for each <strong>row</strong> in the database. This identification value lets you access a specific row, update a property of that row, or even delete the entire row if necessary. Essentially, you should always set up an <nobr>auto-incrementing</nobr> primary key unless you have a very specific reason not to.</p></li>
<li><p>Note that the query string is wrapped in double brackets <nobr>(<code>[[</code> and <code>]]</code>)</nobr> instead of quotes. This is because it’s possible to use both single and double quotes in a SQL query, so using brackets is the safest option.</p></li>
</ul>
</div>
</section>
<section id="creating-new-rows" class="level2">
<h2>Creating New Rows</h2>
<p>Creating new rows is accomplished via the <code>INSERT</code> statement. First, we’ll illustrate the basic usage, then we’ll go over a more dynamic example.</p>
<pre class="brush: lua;">local insertQuery = [[INSERT INTO test VALUES ( NULL, "John", "Smith" );]]
db:exec( insertQuery )</pre>
<p>This example is rather straightforward:</p>
<ul>
<li><p>In the previous code, we created a table called <code>test</code> and now we “insert into” that <code>test</code> table.</p></li>
<li><p>For the row’s values, we list them within parentheses (<code>()</code>) following the <code>VALUES</code> term in the <strong>same order</strong> as the declaration of columns when we created the table. This consistent ordering is very important!</p></li>
</ul>
<div class="code-indent">
<div class="docs-tip-outer">
<div class="docs-tip-inner-left">
<div class="fa fa-cog">

</div>
</div>
<div class="docs-tip-inner-right">
<p>Remember that <code>UserID</code> will <nobr>auto-increment</nobr> to the next number because of the <code>autoincrement</code> flag — this is why we’re able to pass <code>NULL</code> as that column value instead of an actual number.</p>
</div>
</div>
</div>
</section>
<section id="lua-table-to-sql-table" class="level2">
<h2>Lua Table to SQL Table</h2>
<p>Now, let’s get creative with a more dynamic example. The following code will insert three rows into the SQL table (<code>test</code>) based on values extracted from a Lua table (this assumes that you’ve already created the database and the <code>test</code> table).</p>
<pre class="brush: lua;">local people = {
    {
        FirstName = "John",
        LastName = "Smith",
    },
    {
        FirstName = "James",
        LastName = "Nelson",
    },
    {
        FirstName = "Tricia",
        LastName = "Cole",
    },
}

for i = 1,#people do
    local q = [[INSERT INTO test VALUES ( NULL, "]] .. people[i].FirstName .. [[","]] .. people[i].LastName .. [[" );]]
    db:exec( q )
end</pre>
</section>
<section id="updating-existing-rows" class="level2">
<h2>Updating Existing Rows</h2>
<p>You won’t always need to create a new row — in fact, you’ll often need to <strong>update</strong> a row that already exists. In the following example, we’ll assume that the three rows from the previous example are already inserted into the <code>test</code> table.</p>
<pre class="brush: lua;">local q = [[UPDATE test SET FirstName="Trisha" WHERE UserID=3;]]
db:exec( q )</pre>
<p>Essentially, this query finds the row where <code>UserID</code> <nobr>(the primary key)</nobr> equals <code>3</code> and changes the <code>FirstName</code> value to <code>Trisha</code>. While you don’t necessarily need to use the primary key column to find the row, it’s often the easiest way to locate a specific row since it will always be unique.</p>
</section>
<section id="deleting-a-row" class="level2">
<h2>Deleting a Row</h2>
<p>The SQL query for <strong>deleting</strong> a row looks very similar to the query we used to update a row, with the primary difference being the use of <nobr><code>DELETE FROM</code></nobr> rather than <code>UPDATE</code>. The following example removes the <nobr><code>John Smith</code></nobr> row from the <code>test</code> table:</p>
<pre class="brush: lua;">local q = [[DELETE FROM test WHERE UserID=1;]]
db:exec( q )</pre>
</section>
<section id="retrieving-data" class="level2">
<h2>Retrieving Data</h2>
<p>There are several ways to retrieve data from an SQL database. Sometimes you’ll want a single specific row, while other times you might need <strong>all</strong> of the rows in a specific table. In other instances, to narrow it down slightly, you might want only a subset of rows in a certain table based on specific criteria. All of this (and more) is possible with SQLite!</p>
<p>The following example illustrates how to load an existing database from a file and populate a Lua array from the rows of a specific query. This assumes that <code>data.db</code> has our <nobr>3-person</nobr> table (<code>test</code>) included within it:</p>
<pre class="first-line: 1; gutter: true; brush: lua;">-- Require the SQLite library
local sqlite3 = require( "sqlite3" )

-- Create a file path for the database file "data.db"
local path = system.pathForFile( "data.db", system.DocumentsDirectory )

-- Open the database for access
local db = sqlite3.open( path )

-- Create empty "people" table
local people = {}

-- Loop through database table rows via a SELECT query
for row in db:nrows( "SELECT * FROM test" ) do

    print( "Row:", row.UserID )

    -- Create sub-table at next available index of "people" table
    people[#people+1] =
    {
        FirstName = row.FirstName,
        LastName = row.LastName
    }
end</pre>
<p>The most important point of focus is line 14 where we execute a SQL <code>SELECT</code> statement and return an iterator via the <code>nrows()</code> method to be used in conjunction with a <code>for</code> loop, making it easy to go through all of the rows which were found. In this example, we simply copy the data over to the <code>people</code> array so that we can use it later in the app.</p>
<div class="docs-tip-outer">
<div class="docs-tip-inner-left">
<div class="fa fa-cog">

</div>
</div>
<div class="docs-tip-inner-right">
<p>For more information on using the <code>SELECT</code> command to filter data, read <a href="https://zetcode.com/db/sqlite/">this article</a>.</p>
</div>
</div>
</section>
<section id="closing-the-database" class="level2">
<h2>Closing the Database</h2>
<p>When you’re finished accessing a database, it’s very important that you close the “connection” to it by calling the <code>close()</code> method on the database object, for example <code>db:close()</code>:</p>
<pre class="brush: lua;">if ( db and db:isopen() ) then
    db:close()
end</pre>
<p>Of course this code must exist in the correct scope of the database object you’re closing — the <code>db</code> object in the example above — so that Lua understands which database it should close.</p>
</section>
<section id="conclusion" class="level2">
<h2>Conclusion</h2>
<p>That wraps up the essentials of database access in Corona. However, we’ve only scratched the surface of what’s possible with SQLite, so we encourage you to explore further to discover what’s possible, starting with our SQLite <a href="../../../api/library/sqlite3/index.html">documentation</a>.</p>
<hr>
<div id="footer">
<p class="copyright">
© 2020-2024 Solar2D All Rights Reserved.
</p>
<p class="feedback">
Help us help you! If you notice a problem with this page, please report it.
</p>
<p><a class="feedback-button" href="https://github.com/coronalabs/corona-docs/issues" target="_blank">Report an Issue</a></p>
</div>
</section>
</section>
<script src="https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shCore.js" type="text/javascript"></script>
<script src="https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shAutoloader.js" type="text/javascript"></script>
<script type="text/javascript">
    // Define syntax highlighting scripts.
    // N.B.: As a safeguard, you will need to whitelist the brush in filter-SyntaxHighlighter.py

    SyntaxHighlighter.autoloader(
      ['c#','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushCSharp.js'],
      ['java','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushJava.js'],
      ['js','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushJScript.js'],
      ['lua','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushLua.js'],
      ['php','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushPhp.js'],
      ['sql','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushSql.js'],
      ['xml','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushXml.js']
    );

    // Set default configurations.
    SyntaxHighlighter.defaults['gutter'] = false; // Disable line numbers.
    SyntaxHighlighter.defaults['toolbar'] = false; // Disable link back to author's site. :(
	SyntaxHighlighter.defaults['quick-code'] = false; // Disable double click feature

    // Perform the highlighting.
    SyntaxHighlighter.all();
</script>
</body>
</html>
