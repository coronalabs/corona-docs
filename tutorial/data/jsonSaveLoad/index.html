<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="https://www.w3.org/1999/xhtml">
<head>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Cousine&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="icon" type="image/ico" href="/images/favicon.ico" />
  <link rel="shortcut icon" type="image/png" href="/images/favicon.png" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title>Solar2D Documentation — Tutorials | Data/Files/Strings</title>
  <meta name="description" content="Solar2D lets you build games/apps for all major platforms including iOS, Android, Kindle, Apple TV, Android TV, macOS, and Windows. Get the free toolset!" />
  <link rel="stylesheet" href="../../../css/style.css" />
  <link rel="stylesheet" href="../../../css/shCoreDefault.css" />
<script src="https://corona-cdn.coronalabs.com/js/docs.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-9574984-14', 'auto');
  ga('send', 'pageview');
</script>
</head>
<body>
<div class="header"></div>
<div class="title">
	<span class="titleimg" onclick="window.location='https://docs.coronalabs.com/'"></span>
	<div id="nav">
		<ul>
<li><a href="../../../guide/programming/index.html">Getting Started</a></li>
<li><a href="../../../guide/index.html">Guides</a></li>
<li><a href="../../../api/index.html">API Reference</a></li>
<li><a href="../../../tutorial/index.html">Tutorials</a></li>
<li><a href="../../../plugin/index.html">Plugins</a></li>
<li><a href="../../../native/index.html">Solar2D Native</a></li>
<li><a href="../../../coronacards/index.html">CoronaCards</a></li>
</ul>

		<!--
		<div id="resources-link"><a href="https://coronalabs.com/resources/">Corona Resources</a></div>
		-->
	</div>
</div>

<div class="SearchBar">
  <form action="https://www.google.com/cse" id="cse-search-box">
  <input type="hidden" name="cx" value="009283852522218786394:g40gqt2m6rq" />
  <input type="hidden" name="ie" value="UTF-8" />
  <input type="text" placeholder="Search" name="q" id="q" autocomplete="off" size="40" />
  <input type="submit" name="sa" value="Search" />
  </form>
</div>
<div id="TOC">
<ul>
<li><a href="#savingloading-tables-using-json">Saving/Loading Tables Using JSON</a><ul>
<li><a href="#what-is-json">What is JSON?</a></li>
<li><a href="#putting-json-to-work">Putting JSON to Work</a></li>
<li><a href="#savingloading-tables-to-json">Saving/Loading Tables to JSON</a><ul>
<li><a href="#save-function">Save Function</a></li>
<li><a href="#load-function">Load Function</a></li>
<li><a href="#using-the-functions">Using the Functions</a></li>
</ul></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul></li>
</ul>
</div>
<div id="breadcrumb">
<a href="https://docs.coronalabs.com">Documentation</a>  ▸  <a href="../../../tutorial/index.html">Tutorials</a>  ▸  <a href="../../../tutorial/data/index.html">Data/Files/Strings</a>
</div>
<section id="savingloading-tables-using-json" class="level1">
<h1>Saving/Loading Tables Using JSON</h1>
<p>Some developers see the term <strong>JSON</strong> and think that it will be complicated to work with. The <a href="../../../api/library/json/index.html">documentation</a> for JSON can be initially daunting but it’s incredibly useful to understand the basics of JSON and how it can be used for saving/loading data.</p>
<section id="what-is-json" class="level2">
<h2>What is JSON?</h2>
<p><strong>JSON</strong> stands for <strong>JavaScript Object Notation</strong>. It’s how developers define objects as arrays in JavaScript (tables in Lua) and these objects are defined using <nobr>key-value</nobr> pairs, similar to Lua. The syntax is a little different, but a Lua programmer should be able to comprehend it. Consider this data:</p>
<div class="inner-table vert-compact" style="margin-top: -22px;">
<table>
<thead>
<tr class="header">
<th style="text-align: left;"> </th>
<th style="text-align: left;"> </th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Name</strong></td>
<td style="text-align: left;">Clark Kent</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Nickname</strong></td>
<td style="text-align: left;">Superman</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Address</strong></td>
<td style="text-align: left;">Metropolis</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Age</strong></td>
<td style="text-align: left;">32</td>
</tr>
</tbody>
</table>
</div>
<p>If we create a table for this data in Lua, it might look like this:</p>
<pre class="brush: lua;">local hero = {
    name = "Clark Kent",
    nickname = "Superman",
    address = "Metropolis",
    age = 32
}</pre>
<p>Alternatively, the same data could be represented in JSON like this:</p>
<pre class="brush: lua; json">var hero = {
    "name":"Clark Kent",
    "nickname":"Superman",
    "address":"Metropolis",
    "age":32
};</pre>
<p>Notice the similarities between the JSON and Lua code. In both, we declare <nobr>key-value</nobr> pairs where the <strong>key</strong> is on the left side of the <nobr><code>=</code> (Lua)</nobr> or <nobr><code>:</code> (JSON)</nobr> and the <strong>value</strong> is on the right side. One slight difference is that JSON uses a string for the key because one purpose of the notation is to facilitate <strong>serialization</strong>. More specifically, this means turning an <nobr>in-memory</nobr> binary object into something that can be transmitted over a network and then converted back into an <nobr>in-memory</nobr> binary object. Because of this, text, numbers, and booleans (<code>true</code>/<code>false</code>) are the only individual items that can be specified in JSON data — you can <strong>not</strong> include things like Corona display objects or anything dependent on userdata/C memory.</p>
<p>For more complex tables, JSON also supports the use of arrays of items inside square brackets (<code>[]</code>) and objects inside of curly braces (<code>{}</code>). Let’s expand our example data to multiple heroes in a Lua array:</p>
<pre class="brush: lua;">local heroes = {
    { name="Clark Kent", nickname="Superman", address="Metropolis", age=32 },
    { name="Bruce Wayne", nickname="Batman", address="Gotham", age=36 },
    { name="Diana Prince", nickname="Wonder Woman", address="New York", age=28 },
}</pre>
<p>Or in JSON…</p>
<pre class="brush: lua; json">var heroes = [
    { "name":"Clark Kent", "nickname":"Superman", "address":"Metropolis", "age":32 },
    { "name":"Bruce Wayne", "nickname":"Batman", "address":"Gotham", "age":36 },
    { "name":"Diana Prince", "nickname":"Wonder Woman", "address":"New York", "age":28 },
    ]
};</pre>
<p>Notice again that it’s quite similar to Lua — this is one reason why JSON is popular among Lua developers. The syntax of JSON is also more compact and lightweight compared to XML where you need both an opening and closing tag in addition to the data. Finally, JSON is also used by many online services which your app may connect to.</p>
</section>
<section id="putting-json-to-work" class="level2">
<h2>Putting JSON to Work</h2>
<p>As a Corona developer, it’s not necessary to fully understand JSON to utilize it because we provide two convenient API calls as part of the <nobr>built-in</nobr> <a href="../../../api/library/json/index.html">JSON</a> library. The function <a href="../../../api/library/json/encode.html">json.encode()</a> accepts a Lua table and converts it to <nobr>string-formatted JSON</nobr> (this is where the data is <strong>serialized</strong>). Conversely, when handling a string of formatted JSON data, it can be converted back to a Lua table using <a href="../../../api/library/json/decode.html">json.decode()</a> (this is where the data <nobr>is <strong>de-serialized</strong>)</nobr>.</p>
<p>Using the example data above, let’s <strong>encode</strong> a Lua table to JSON using <a href="../../../api/library/json/encode.html">json.encode()</a> and <code>print()</code> its value to the Corona console:</p>
<pre class="highlight: [9,10]; first-line: 1; gutter: false; brush: lua;">local json = require( "json" )  -- Include the Corona JSON library

local heroes = {
    { name="Clark Kent", nickname="Superman", address="Metropolis", age=32 },
    { name="Bruce Wayne", nickname="Batman", address="Gotham", age=36 },
    { name="Diana Prince", nickname="Wonder Woman", address="New York", age=28 },
}

local serializedJSON = json.encode( heroes )
print( serializedJSON )</pre>
<p>This outputs something like the following:</p>
<pre class="brush: lua;">[{"nickname":"Superman","age":32,"name":"Clark Kent","address":"Metropolis"},{"nickname":"Batman","age":36,"name":"Bruce Wayne","address":"Gotham"},{"nickname":"Wonder Woman","age":28,"name":"Diana Prince","address":"New York"}]</pre>
<p>Now, to <strong>decode</strong> this JSON string back into a Lua table, simply call <a href="../../../api/library/json/decode.html">json.decode()</a> and <code>print()</code> its value to the console. This will output a typical memory reference to the Lua table created, for instance <nobr><code>table: 0x6080010613c0</code></nobr>, and that table of data can be used just like any other Lua table.</p>
<pre class="highlight: [4,5]; first-line: 1; gutter: false; brush: lua;">local serializedJSON = json.encode( heroes )
print( serializedJSON )

local newHeroes = json.decode( serializedJSON )
print( newHeroes )</pre>
<p>With these two steps, we converted a Lua table into a JSON string and then converted it back to a Lua table, and it wasn’t even necessary to understand JSON. This is how simple JSON can be!</p>
</section>
<section id="savingloading-tables-to-json" class="level2">
<h2>Saving/Loading Tables to JSON</h2>
<p>One of the most useful purposes of encoding and decoding data between Lua and JSON is <nobr><strong>saving and loading data</strong></nobr> to/from local storage. This lets you accomplish a myriad of tasks including storing game settings, reading level data/configurations, keeping track of high scores between sessions, and nearly any other task where you need to store a reasonably predictable amount of data.</p>
<div class="guide-notebox">
<div class="notebox-title">
Note
</div>
<p>If you need to handle a larger amount of data in <strong>database</strong> format, or if you need to sort and filter data based on varying parameters, JSON is <strong>not</strong> an ideal solution. In cases like these, consult the <a href="../../../tutorial/data/databaseAccess/index.html">Database Access Using SQLite</a> tutorial for details on how to save, load, and utilize data in SQLite databases.</p>
</div>
<p>Let’s begin by creating a convenient Lua module to contain the necessary functions. You can study this concept further in the <a href="../../../tutorial/basics/externalModules/index.html">External Modules in Corona</a> tutorial, but basically we’ll begin with a typical setup:</p>
<pre class="first-line: 1; gutter: true; brush: lua;">local M = {}

local json = require( "json" )
local defaultLocation = system.DocumentsDirectory

return M</pre>
<p>Save this file to your main project directory as <code>loadsave.lua</code>. Essentially, this initial code sets up a Lua table <code>M</code> which will store the functions we create in the following sections, and it returns that table so that those functions will be accessible to any module which <nobr><code>require()</code>-s</nobr> this module. Additionally, since we’re obviously going to use JSON, we include the Corona JSON library and set the default persistent location (<code>system.DocumentsDirectory</code>) to save/load JSON files to/from.</p>
<section id="save-function" class="level3">
<h3>Save Function</h3>
<p>Now let’s add a <strong>save</strong> function to the <code>loadsave.lua</code> module:</p>
<pre class="highlight: [7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]; first-line: 1; gutter: true; brush: lua;">local M = {}

local json = require( "json" )
local defaultLocation = system.DocumentsDirectory


function M.saveTable( t, filename, location )

    local loc = location
    if not location then
        loc = defaultLocation
    end

    -- Path for the file to write
    local path = system.pathForFile( filename, loc )

    -- Open the file handle
    local file, errorString = io.open( path, "w" )

    if not file then
        -- Error occurred; output the cause
        print( "File error: " .. errorString )
        return false
    else
        -- Write encoded JSON data to file
        file:write( json.encode( t ) )
        -- Close the file handle
        io.close( file )
        return true
    end
end

return M</pre>
<p>This function is relatively straightforward and it follows the basic example in the <a href="../../../guide/data/readWriteFiles/index.html#writing-files">Reading and Writing Files</a> guide. Essentially it works like this:</p>
<ul>
<li><p>This function accepts three parameters: <code>t</code>, <code>filename</code>, and <code>location</code> — <code>t</code> is the Lua table which should be converted to JSON and saved, <code>filename</code> is the name of the target JSON file, and <code>location</code> is the local storage location at which to save the file.</p></li>
<li><p>Inside the function, we first set the local storage location. If the <code>location</code> parameter is not defined, we set this to <code>defaultLocation</code> (<code>system.DocumentsDirectory</code>) which is where files should be saved in 99% of cases.</p></li>
<li><p>Next, we create the path to the destination file based on the <code>filename</code> parameter and location.</p></li>
<li><p>Following this, we open the file handle with <strong>write</strong> access (<code>"w"</code>) since we’re saving (writing) the file.</p></li>
<li><p>Finally, assuming the file handle is valid, we write the <nobr>JSON-encoded</nobr> table <nobr>(<code>json.encode( t )</code>)</nobr> to the destination file path, close the file handle, and return <code>true</code>.</p></li>
</ul>
</section>
<section id="load-function" class="level3">
<h3>Load Function</h3>
<p>Saving data isn’t very useful without a method to load it back into memory, so let’s add a <strong>load</strong> function to the <code>loadsave.lua</code> module:</p>
<pre class="highlight: [34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60]; first-line: 34; gutter: true; brush: lua;">function M.loadTable( filename, location )

    local loc = location
    if not location then
        loc = defaultLocation
    end

    -- Path for the file to read
    local path = system.pathForFile( filename, loc )

    -- Open the file handle
    local file, errorString = io.open( path, "r" )

    if not file then
        -- Error occurred; output the cause
        print( "File error: " .. errorString )
    else
        -- Read data from file
        local contents = file:read( "*a" )
        -- Decode JSON data into Lua table
        local t = json.decode( contents )
        -- Close the file handle
        io.close( file )
        -- Return table
        return t
    end
end

return M</pre>
<p>This function is also fairly basic:</p>
<ul>
<li><p>This time, just two parameters are needed: <code>filename</code> and <code>location</code> — <code>filename</code> is the name of the JSON file to read and <code>location</code> is its local storage location.</p></li>
<li><p>Inside the function, we first determine the local storage location. As with the <code>saveTable()</code> function, this is set to a default of <code>system.DocumentsDirectory</code> unless otherwise specified by the <code>location</code> parameter.</p></li>
<li><p>Next, we create the path to the file based on the <code>filename</code> parameter and location.</p></li>
<li><p>Following this, we open the file handle with <strong>read</strong> access (<code>"r"</code>) since we’re loading (reading) the file.</p></li>
<li><p>Finally, assuming the file handle is valid, we read the file data into a <code>contents</code> string, decode it back to a Lua table <nobr>(<code>json.decode( contents )</code>)</nobr>, close the file handle, and return <code>t</code> so that the Lua table is returned when calling this function.</p></li>
</ul>
</section>
<section id="using-the-functions" class="level3">
<h3>Using the Functions</h3>
<p>As a very simple example, let’s assume that we have a table containing various game settings. Using this table, we can save the data using the <code>saveTable()</code> function. This will encode the Lua table to JSON and save it to <code>system.DocumentsDirectory()</code> (default) as <code>settings.json</code>.</p>
<pre class="brush: lua;">local loadsave = require( "loadsave" )

local gameSettings = {
    musicOn = true,
    soundOn = true,
    difficulty = "easy",
    highScore = 10000,
    highestLevel = 7
}

loadsave.saveTable( gameSettings, "settings.json" )</pre>
<p>Then, to load the data back in, we can use the <code>loadTable()</code> function, requesting the file that was just saved:</p>
<pre class="brush: lua;">local loadedSettings = loadsave.loadTable( "settings.json" )</pre>
<div class="docs-tip-outer">
<div class="docs-tip-inner-left">
<div class="fa fa-cog">

</div>
</div>
<div class="docs-tip-inner-right">
<p>If you frequently save and load data with multiple keys/values, a <strong>table output</strong> function may be extremely useful to inspect exactly what’s contained within the loaded table. Several examples of this concept exist online, but one proven and powerful version can be found in the <a href="../../../tutorial/data/outputTable/index.html">Outputting Table Contents</a> tutorial.</p>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level2">
<h2>Conclusion</h2>
<p>As illustrated in this tutorial, JSON provides a lightweight method to convert Lua tables into serialized text strings which can be exchanged between online services or saved to local files. Then, with just one line, they can be restored to the original Lua format.</p>
<hr>
<div id="footer">
<p class="copyright">
© 2020-2024 Solar2D All Rights Reserved.
</p>
<p class="feedback">
Help us help you! If you notice a problem with this page, please report it.
</p>
<p><a class="feedback-button" href="https://github.com/coronalabs/corona-docs/issues" target="_blank">Report an Issue</a></p>
</div>
</section>
</section>
<script src="https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shCore.js" type="text/javascript"></script>
<script src="https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shAutoloader.js" type="text/javascript"></script>
<script type="text/javascript">
    // Define syntax highlighting scripts.
    // N.B.: As a safeguard, you will need to whitelist the brush in filter-SyntaxHighlighter.py

    SyntaxHighlighter.autoloader(
      ['c#','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushCSharp.js'],
      ['java','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushJava.js'],
      ['js','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushJScript.js'],
      ['lua','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushLua.js'],
      ['php','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushPhp.js'],
      ['sql','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushSql.js'],
      ['xml','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushXml.js']
    );

    // Set default configurations.
    SyntaxHighlighter.defaults['gutter'] = false; // Disable line numbers.
    SyntaxHighlighter.defaults['toolbar'] = false; // Disable link back to author's site. :(
	SyntaxHighlighter.defaults['quick-code'] = false; // Disable double click feature

    // Perform the highlighting.
    SyntaxHighlighter.all();
</script>
</body>
</html>
