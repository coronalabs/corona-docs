<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="https://www.w3.org/1999/xhtml">
<head>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Cousine&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="icon" type="image/ico" href="/images/favicon.ico" />
  <link rel="shortcut icon" type="image/png" href="/images/favicon.png" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title>Solar2D Documentation — Tutorials | Gaming/Physics</title>
  <meta name="description" content="Solar2D lets you build games/apps for all major platforms including iOS, Android, Kindle, Apple TV, Android TV, macOS, and Windows. Get the free toolset!" />
  <link rel="stylesheet" href="../../../css/style.css" />
  <link rel="stylesheet" href="../../../css/shCoreDefault.css" />
<script src="https://corona-cdn.coronalabs.com/js/docs.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-9574984-14', 'auto');
  ga('send', 'pageview');
</script>
</head>
<body>
<div class="header"></div>
<div class="title">
	<span class="titleimg" onclick="window.location='https://docs.coronalabs.com/'"></span>
	<div id="nav">
		<ul>
<li><a href="../../../guide/programming/index.html">Getting Started</a></li>
<li><a href="../../../guide/index.html">Guides</a></li>
<li><a href="../../../api/index.html">API Reference</a></li>
<li><a href="../../../tutorial/index.html">Tutorials</a></li>
<li><a href="../../../plugin/index.html">Plugins</a></li>
<li><a href="../../../native/index.html">Solar2D Native</a></li>
<li><a href="../../../coronacards/index.html">CoronaCards</a></li>
</ul>

		<!--
		<div id="resources-link"><a href="https://coronalabs.com/resources/">Corona Resources</a></div>
		-->
	</div>
</div>

<div class="SearchBar">
  <form action="https://www.google.com/cse" id="cse-search-box">
  <input type="hidden" name="cx" value="009283852522218786394:g40gqt2m6rq" />
  <input type="hidden" name="ie" value="UTF-8" />
  <input type="text" placeholder="Search" name="q" id="q" autocomplete="off" size="40" />
  <input type="submit" name="sa" value="Search" />
  </form>
</div>
<div id="TOC">
<ul>
<li><a href="#allowing-jumps">Allowing Jumps</a><ul>
<li><a href="#foot-sensor-method">Foot Sensor Method</a></li>
<li><a href="#constructing-terrain">Constructing Terrain</a></li>
<li><a href="#character-body">Character Body</a></li>
<li><a href="#jump-handler">Jump Handler</a></li>
<li><a href="#collision-handler">Collision Handler</a></li>
<li><a href="#conclusion">Conclusion</a></li>
<li><a href="#section"></a></li>
</ul></li>
</ul>
</div>
<div id="breadcrumb">
<a href="https://docs.coronalabs.com">Documentation</a>  ▸  <a href="../../../tutorial/index.html">Tutorials</a>  ▸  <a href="../../../tutorial/games/index.html">Gaming/Physics</a>
</div>
<section id="allowing-jumps" class="level1">
<h1>Allowing Jumps</h1>
<p>For a 2D platformer game in which a character can jump, you’ll almost always want to ensure that your player’s character can <strong>only</strong> jump when standing on solid ground. Even in games which allow for the popular “double jump” or “air jump,” it’s almost always expected that the player is standing upon a solid foundation to make the <strong>initial</strong> jump.</p>
<p>Game developers tend to approach this scenario differently. One option is to check if the character’s vertical velocity is low enough to indicate that it’s on the ground — in other words, if the character isn’t falling downward or already moving upward (jumping), it’s reasonably likely that the character is standing on solid ground. Another option, following a jump, is to use a short timer and set a boolean flag so that the character can’t jump again until it returns to the ground. While these are valid approaches, they are more complicated than necessary, they’re potentially unreliable, and they may introduce other jump handling issues.</p>
<section id="foot-sensor-method" class="level2">
<h2>Foot Sensor Method</h2>
<div class="float-right" style="max-width: 200px; margin-bottom: 16px; clear: both;">
<p><img src="../../../images/docs/allow-jump-1.png" /></p>
</div>
<p>A cleaner and more reliable approach — although it takes a bit more <nobr>up-front</nobr> setup — is a “foot sensor” attached as a second element to the character’s physics body. As depicted here, this sensor protrudes just a small amount <strong>below</strong> the character’s base.</p>
<p>Because this element will be set as a <strong>sensor</strong> type object, it won’t physically interact with solid ground, merely overlap it, and when that overlap occurs over a ground object, we can assume that the character is firmly standing on solid ground and it’s safe to jump.</p>
<p>Optionally, as shown here, the width of this sensor can be thinner than the character’s overall body width to prevent a jump while teetering on the edge of a platform. However, this and other specific decisions you make about the sensor element’s width/placement relative to the character’s main body element are highly dependent on your unique game design.</p>
</section>
<section id="constructing-terrain" class="level2">
<h2>Constructing Terrain</h2>
<p>Terrain can be constructed in various ways. For this tutorial, we’ll simply use a vector rectangle with a static physical body applied. We’ll also add a <code>objType</code> property of <code>"ground"</code> to the object — this will allow us to limit player jumps solely from solid ground, not off other horizontal objects like pools of liquid or pits of spikes (clearly those game elements would need to be handled separately and differently).</p>
<pre class="brush: lua;">-- Set up physics engine
local physics = require( "physics" )
physics.start()
physics.setDrawMode( "hybrid" )

-- Create ground object
local cw, ch = display.actualContentWidth, display.actualContentHeight
local ground = display.newRect( display.contentCenterX, ch-64, cw, 64 )
ground:setFillColor( 0.4, 0.4, 0.8 )
ground.objType = "ground"
physics.addBody( ground, "static", { bounce=0.0, friction=0.3 } )</pre>
</section>
<section id="character-body" class="level2">
<h2>Character Body</h2>
<p>The character can be constructed of <strong>two</strong> body elements as follows. Notice that the second body element is a sensor and it’s declared using the <code>box</code> shape method which lets us offset it vertically from the main body’s center point:</p>
<pre class="brush: lua;">-- Create character
local character = display.newRect( display.contentCenterX, ground.y-150, 80, 120 )
character:setFillColor( 1, 0.2, 0.4 )

physics.addBody( character, "dynamic",
    { density=1.0, bounce=0.0 },  -- Main body element
    { box={ halfWidth=30, halfHeight=10, x=0, y=60 }, isSensor=true }  -- Foot sensor element
)
character.isFixedRotation = true
character.sensorOverlaps = 0</pre>
<div class="docs-tip-outer docs-tip-color-alert">
<div class="docs-tip-inner-left">
<div class="fa fa-exclamation-circle" style="font-size: 35px;">

</div>
</div>
<div class="docs-tip-inner-right">
<p>Observe that the foot sensor element is declared <nobr><strong>second in order</strong> —</nobr> this is critical because the index order of <code>2</code> will be used in the collision detector function to check that the <strong>sensor</strong> <nobr>(not the main body)</nobr> collided with the ground.</p>
</div>
</div>
<p>Notice that we’ve also added a <code>sensorOverlaps</code> <strong>counter</strong> to the character to manage its ability to jump. A counter <nobr>(not a boolean <code>true</code>/<code>false</code>)</nobr> is useful for a very specific reason: if you place two ground objects directly beside each other, the foot sensor will briefly overlap <strong>both</strong> of them as the character moves across the “seam” between them. Using a <code>true</code>/<code>false</code> boolean property instead of a counter would result in unexpected behavior as the sensor exits one ground object and changes to <code>false</code>, even though physically the character is standing on the second ground object and can legally jump. Thus, we can use a counter which increments and decrements as the sensor interacts with one or more ground objects.</p>
</section>
<section id="jump-handler" class="level2">
<h2>Jump Handler</h2>
<p>The jump procedure is simple enough — when the touch initially registers, we just check if the <code>sensorOverlaps</code> counter is greater than <code>0</code> and jump. For simplicity in this tutorial, we use global <code>Runtime</code> touch detection to trigger a jump, and the jump itself is a basic upwards linear impulse immediately following the character’s linear <strong>y</strong> velocity being reset to <code>0</code>.</p>
<pre class="brush: lua;">local function touchAction( event )

    if ( event.phase == "began" and character.sensorOverlaps > 0 ) then
        -- Jump procedure here
        local vx, vy = character:getLinearVelocity()
        character:setLinearVelocity( vx, 0 )
        character:applyLinearImpulse( nil, -75, character.x, character.y )
    end
end
Runtime:addEventListener( "touch", touchAction )</pre>
</section>
<section id="collision-handler" class="level2">
<h2>Collision Handler</h2>
<p>The final aspect is the collision handler function. Here, we just need to check the following:</p>
<ol type="1">
<li><p>The colliding body element index (<code>event.selfElement</code>) is <code>2</code> — this indicates that the <strong>foot sensor</strong> has registered the collision event, not the character’s main body element.</p></li>
<li><p>The terrain element is a ground object <nobr>(<code>objType</code> of <code>"ground"</code>)</nobr>, in which case the character can safely jump off it.</p></li>
</ol>
<p>Inside this conditional clause, we perform one of the following actions:</p>
<ul>
<li><p>On the <code>"began"</code> phase (foot sensor has <strong>entered</strong> a ground object), we <strong>increment</strong> the <code>sensorOverlaps</code> counter.</p></li>
<li><p>On the <code>"ended"</code> phase (foot sensor has <strong>exited</strong> a ground object), we <strong>decrement</strong> the <code>sensorOverlaps</code> counter.</p></li>
</ul>
<pre class="brush: lua;">local function sensorCollide( self, event )

    -- Confirm that the colliding elements are the foot sensor and a ground object
    if ( event.selfElement == 2 and event.other.objType == "ground" ) then

        -- Foot sensor has entered (overlapped) a ground object
        if ( event.phase == "began" ) then
            self.sensorOverlaps = self.sensorOverlaps + 1
        -- Foot sensor has exited a ground object
        elseif ( event.phase == "ended" ) then
            self.sensorOverlaps = self.sensorOverlaps - 1
        end
    end
end
-- Associate collision handler function with character
character.collision = sensorCollide
character:addEventListener( "collision" )</pre>
<div class="float-right" style="max-width: 430px; margin-bottom: 16px; clear: both;">
<p><img src="../../../images/docs/allow-jump-2.png" /></p>
</div>
<p>Now, if you run this code, you’ll see how the foot sensor’s overlapping state with the ground controls whether <code>character</code> can or can’t jump. Essentially, the foot sensor serves as a permanent “foundation” which you can use to test if the character is standing upon solid ground.</p>
</section>
<section id="conclusion" class="level2">
<h2>Conclusion</h2>
<p>The method used in this tutorial is just one of several ways to handle the “allowing jumps” issue, and by no means is it the <strong>only</strong> solution or even best solution for every game. Hopefully, though, this simple method can be adjusted and tailored to your game, letting you abandon vertical velocity checks, jump timers, and other <nobr>error-prone</nobr> methods.</p>
<!--- LEGAL -->
</section>
<section id="section" class="level2">
<h2></h2>
<div class="tiny-copy">
<p>Character art in this tutorial is courtesy of <a href="https://kenney.nl/">Kenney</a>. Kenney game studio supports other developers by creating free game assets and high quality learning material.</p>
</div>
<hr>
<div id="footer">
<p class="copyright">
© 2020-2024 Solar2D All Rights Reserved.
</p>
<p class="feedback">
Help us help you! If you notice a problem with this page, please report it.
</p>
<p><a class="feedback-button" href="https://github.com/coronalabs/corona-docs/issues" target="_blank">Report an Issue</a></p>
</div>
</section>
</section>
<script src="https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shCore.js" type="text/javascript"></script>
<script src="https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shAutoloader.js" type="text/javascript"></script>
<script type="text/javascript">
    // Define syntax highlighting scripts.
    // N.B.: As a safeguard, you will need to whitelist the brush in filter-SyntaxHighlighter.py

    SyntaxHighlighter.autoloader(
      ['c#','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushCSharp.js'],
      ['java','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushJava.js'],
      ['js','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushJScript.js'],
      ['lua','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushLua.js'],
      ['php','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushPhp.js'],
      ['sql','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushSql.js'],
      ['xml','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushXml.js']
    );

    // Set default configurations.
    SyntaxHighlighter.defaults['gutter'] = false; // Disable line numbers.
    SyntaxHighlighter.defaults['toolbar'] = false; // Disable link back to author's site. :(
	SyntaxHighlighter.defaults['quick-code'] = false; // Disable double click feature

    // Perform the highlighting.
    SyntaxHighlighter.all();
</script>
</body>
</html>
