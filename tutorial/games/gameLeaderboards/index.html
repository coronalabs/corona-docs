<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="https://www.w3.org/1999/xhtml">
<head>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Cousine&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="icon" type="image/ico" href="/images/favicon.ico" />
  <link rel="shortcut icon" type="image/png" href="/images/favicon.png" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title>Solar2D Documentation — Tutorials | Gaming/Physics</title>
  <meta name="description" content="Solar2D lets you build games/apps for all major platforms including iOS, Android, Kindle, Apple TV, Android TV, macOS, and Windows. Get the free toolset!" />
  <link rel="stylesheet" href="../../../css/style.css" />
  <link rel="stylesheet" href="../../../css/shCoreDefault.css" />
<script src="https://corona-cdn.coronalabs.com/js/docs.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-9574984-14', 'auto');
  ga('send', 'pageview');
</script>
</head>
<body>
<div class="header"></div>
<div class="title">
	<span class="titleimg" onclick="window.location='https://docs.coronalabs.com/'"></span>
	<div id="nav">
		<ul>
<li><a href="../../../guide/programming/index.html">Getting Started</a></li>
<li><a href="../../../guide/index.html">Guides</a></li>
<li><a href="../../../api/index.html">API Reference</a></li>
<li><a href="../../../tutorial/index.html">Tutorials</a></li>
<li><a href="../../../plugin/index.html">Plugins</a></li>
<li><a href="../../../native/index.html">Solar2D Native</a></li>
<li><a href="../../../coronacards/index.html">CoronaCards</a></li>
</ul>

		<!--
		<div id="resources-link"><a href="https://coronalabs.com/resources/">Corona Resources</a></div>
		-->
	</div>
</div>

<div class="SearchBar">
  <form action="https://www.google.com/cse" id="cse-search-box">
  <input type="hidden" name="cx" value="009283852522218786394:g40gqt2m6rq" />
  <input type="hidden" name="ie" value="UTF-8" />
  <input type="text" placeholder="Search" name="q" id="q" autocomplete="off" size="40" />
  <input type="submit" name="sa" value="Search" />
  </form>
</div>
<div id="TOC">
<ul>
<li><a href="#implementing-game-leaderboards">Implementing Game Leaderboards</a><ul>
<li><a href="#collecting-information">Collecting Information</a><ul>
<li><a href="#google">Google</a></li>
<li><a href="#apple">Apple</a></li>
</ul></li>
<li><a href="#project-settings">Project Settings</a><ul>
<li><a href="#google-1">Google</a></li>
<li><a href="#apple-1">Apple</a></li>
</ul></li>
<li><a href="#data-module">Data Module</a></li>
<li><a href="#platform-detection">Platform Detection</a></li>
<li><a href="#game-network-initialization">Game Network Initialization</a></li>
<li><a href="#sending-scores-to-the-leaderboard">Sending Scores to the Leaderboard</a></li>
<li><a href="#showing-the-leaderboard">Showing the Leaderboard</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul></li>
</ul>
</div>
<div id="breadcrumb">
<a href="https://docs.coronalabs.com">Documentation</a>  ▸  <a href="../../../tutorial/index.html">Tutorials</a>  ▸  <a href="../../../tutorial/games/index.html">Gaming/Physics</a>
</div>
<section id="implementing-game-leaderboards" class="level1">
<h1>Implementing Game Leaderboards</h1>
<p>Implementing <strong>leaderboards</strong> is an activity which many developers want to understand so that they can include them among their game features. Corona supports various services for managing leaderboards including <a href="../../../plugin/gpgs/index.html">Google Play Games Services</a> and <a href="../../../plugin/gameNetwork-apple/index.html">Apple Game Center</a>.</p>
<p>This tutorial will outline one way of setting up your game to use both <nobr>Google Play Games Services</nobr> <strong>and</strong> <nobr>Apple Game Center</nobr>.</p>
<div class="guide-notebox">
<div class="notebox-title">
Note
</div>
<p>This tutorial does not outline setting up your game(s) in iTunes Connect or Google Play. Please refer to the many online resources for those instructions.</p>
</div>
<section id="collecting-information" class="level2">
<h2>Collecting Information</h2>
<section id="google" class="level3">
<h3>Google</h3>
<p>For <nobr>Google Play Games Services</nobr>, you will need to gather various details from the <a href="https://console.developers.google.com/">Google Play Developer Console</a>, including:</p>
<ol type="1">
<li><p>Your <strong>license key</strong>, a very long string found within the developer console.</p></li>
<li><p>Your <nobr><strong>Google Play Games App ID</strong></nobr>.</p></li>
<li><p>The string that identifies your leaderboard — this looks something like <code>CgkA8kb12jK0onOQBg</code>.</p></li>
</ol>
<p>Keep record of all this information since you’ll need to provide it to your Corona app.</p>
</section>
<section id="apple" class="level3">
<h3>Apple</h3>
<p>Apple Game Center also requires you to gather some information for your app code. When you create a leaderboard, you’ll be asked to give it a unique name. It’s recommended that you follow the <nobr>reverse-domain</nobr> naming scheme such as <code>com.yourdomain.yourgame.leaderboardname</code>. Make a note of this since you’ll need to specify it within your Corona app.</p>
</section>
</section>
<section id="project-settings" class="level2">
<h2>Project Settings</h2>
<p>For each respective service, you’ll need to include the information gathered above within specific areas of your Corona project.</p>
<section id="google-1" class="level3">
<h3>Google</h3>
<p>Details on the necessary <a href="../../../plugin/gpgs/index.html">Google Play Games Services</a> settings can be found in the <a href="../../../plugin/gpgs/index.html">documentation</a>, but here’s an overview on the necessary aspects:</p>
<ol type="1">
<li><p>Implement Google app licensing as outlined <a href="../../../api/library/licensing/index.html">here</a> and sign the <code>.apk</code> with a private key as outlined <a href="../../../guide/distribution/androidBuild/index.html#signrelease">here</a>.</p></li>
<li><p>Ensure that you have enabled both <strong>Drive API</strong> and <nobr><strong>Google Play Developer API</strong></nobr> within the <a href="https://console.developers.google.com/">Google Play Developer Console</a>.</p></li>
<li><p>Add an entry into the <code>plugins</code> table of <code>build.settings</code> for the <nobr>Google Play Games Services</nobr> plugin:</p></li>
</ol>
<div class="code-indent">
<pre class="highlight: [5,6,7,8,9]; first-line: 1; gutter: false; brush: lua;">settings = {

    plugins =
    {
        ["plugin.gpgs.v2"] =
        {
            publisherId = "com.coronalabs",
            supportedPlatforms = { android=true }
        },
    },
}</pre>
</div>
<ol start="4" type="1">
<li>Specify the <nobr>Google Play Games App ID</nobr> in the <code>android</code> table of <code>build.settings</code> as the <code>googlePlayGamesAppId</code> key:</li>
</ol>
<div class="code-indent">
<pre class="highlight: [5]; first-line: 1; gutter: false; brush: lua;">settings = {

    android =
    {
        googlePlayGamesAppId = "YOUR_APPLICATION_ID",
    },
}</pre>
</div>
</section>
<section id="apple-1" class="level3">
<h3>Apple</h3>
<p><a href="../../../plugin/gameNetwork-apple/index.html">Apple Game Center</a> is a bit easier — basically, just include the plugin within the <code>plugins</code> table of <code>build.settings</code> as follows:</p>
<pre class="highlight: [5,6,7,8]; first-line: 1; gutter: false; brush: lua;">settings =
{
    plugins =
    {
        ["CoronaProvider.gameNetwork.apple"] =
        {
            publisherId = "com.coronalabs"
        },
    },
}</pre>
</section>
</section>
<section id="data-module" class="level2">
<h2>Data Module</h2>
<p>In the <a href="../../../tutorial/basics/globals/index.html">Goodbye Globals!</a> tutorial, we outlined how to use a <strong>data module</strong> to share information between scenes and modules. This technique will be used again to store the various game networking plugin handles used in this tutorial.</p>
<ol type="1">
<li>To begin, create a new blank Lua file named <code>globalData.lua</code> and save it to your project directory. Inside, include the following lines:</li>
</ol>
<div class="code-indent">
<pre class="first-line: 1; gutter: true; brush: lua;">-- Pseudo-global space
local M = {}

return M</pre>
</div>
<ol start="2" type="1">
<li>Now, in the <code>main.lua</code> file, <code>require()</code> the data module and add two variables to its table, <code>globalData.gpgs</code> and <code>globalData.gameCenter</code>, both initially set to <code>nil</code>. These will hold the plugin handles for later use.</li>
</ol>
<div class="code-indent">
<pre class="first-line: 1; gutter: true; brush: lua;">local globalData = require( "globalData" )
local json = require( "json" )

globalData.gpgs = nil
globalData.gameCenter = nil</pre>
<div class="docs-tip-outer">
<div class="docs-tip-inner-left">
<div class="fa fa-cog">

</div>
</div>
<div class="docs-tip-inner-right">
<p>Note that we also <code>require()</code> the <a href="../../../api/library/json/index.html">JSON</a> library. This is not essential for all implementations, but we’ll use JSON in this tutorial to output game network response data to the console.</p>
</div>
</div>
</div>
</section>
<section id="platform-detection" class="level2">
<h2>Platform Detection</h2>
<p>Next, let’s test to see what platform the user is on. If it’s an Android device, we’ll <code>require()</code> <nobr>Google Play Games Services</nobr>; if iOS, we’ll <code>require()</code> <nobr>Apple Game Center</nobr>. Note that each respective inclusion is stored in the <code>globalData</code> handles configured above.</p>
<pre class="highlight: [7,8,9,10,11,12,13,14]; first-line: 1; gutter: true; brush: lua;">local globalData = require( "globalData" )
local json = require( "json" )

globalData.gpgs = nil
globalData.gameCenter = nil

local platform = system.getInfo( "platform" )
local env = system.getInfo( "environment" )

if ( platform == "android" and env ~= "simulator" ) then
    globalData.gpgs = require( "plugin.gpgs.v2" )
elseif ( platform == "ios" and env ~= "simulator" ) then
    globalData.gameCenter = require( "gameNetwork" )
end</pre>
</section>
<section id="game-network-initialization" class="level2">
<h2>Game Network Initialization</h2>
<p>Now we’re ready to initialize and log the user in to the proper game network. For this, we’ll first need to add <strong>listener functions</strong> to handle game network initialization events. Since Lua is a <nobr>one-pass</nobr> compiler, you need to write your code in reverse order. The basic workflow is to initialize the plugin which will trigger an event that will be processed in a listener function.</p>
<div class="docs-tip-outer">
<div class="docs-tip-inner-left">
<div class="fa fa-cog">

</div>
</div>
<div class="docs-tip-inner-right">
<p>This is one major point where <nobr>Google Play Games Services</nobr> and <nobr>Apple Game Center</nobr> differ. For Apple, the initialization process automatically logs the user in, but for Google, you must explicitly call a command to log the user in. Also, the GPGS v2 plugin no longer has a <code>.init()</code> call. You just to need to login.</p>
</div>
</div>
<pre class="first-line: 16; gutter: true; brush: lua;">-- Google Play Games Services initialization/login listener
local function gpgsInitListener( event )

    if not event.isError then
        if ( event.name == "login" ) then  -- Successful login event
            print( json.prettify(event) )
        end
    end
end

-- Apple Game Center initialization/login listener
local function gcInitListener( event )

    if event.data then  -- Successful login event
        print( json.prettify(event) )
    end
end</pre>
<div class="guide-notebox">
<div class="notebox-title">
Note
</div>
<p>You can perform additional tasks upon successful login, for instance requesting player information, but for the purpose of this tutorial, we simply output the values returned by the event.</p>
</div>
<p>With the listener functions in place, we can now initialize the game network depending on which platform the user is on:</p>
<pre class="first-line: 38; gutter: true; brush: lua;">-- Initialize game network based on platform
if ( globalData.gpgs ) then
    -- Initialize Google Play Games Services
    globalData.gpgs.login( { userInitiated=true, listener=gpgsInitListener } )

elseif ( globalData.gameCenter ) then
    -- Initialize Apple Game Center
    globalData.gameCenter.init( "gamecenter", gcInitListener )
end</pre>
</section>
<section id="sending-scores-to-the-leaderboard" class="level2">
<h2>Sending Scores to the Leaderboard</h2>
<p>Now that we have the game network initialized and the user is logged in, we’re ready to transmit scores. Normally you would do this after the game is over, or perhaps after the player accomplishes something noteworthy. If you’re tracking the user’s high score locally, you can choose to only transmit a score that you know to be a high score, or alternatively you can send the score to <nobr>Google Play Games Services</nobr> or <nobr>Apple Game Center</nobr> anyway and let the service decide if it needs to record a high score.</p>
<p>For this, similar to the initialization process, we’ll need a listener function for submitted scores:</p>
<pre class="first-line: 48; gutter: true; brush: lua;">local function submitScoreListener( event )

    -- Google Play Games Services score submission
    if ( globalData.gpgs ) then

        if not event.isError then
            local isBest = nil
            if ( event.scores["daily"].isNewBest ) then
                isBest = "a daily"
            elseif ( event.scores["weekly"].isNewBest ) then
                isBest = "a weekly"
            elseif ( event.scores["all time"].isNewBest ) then
                isBest = "an all time"
            end
            if isBest then
                -- Congratulate player on a high score
                local message = "You set " .. isBest .. " high score!"
                native.showAlert( "Congratulations", message, { "OK" } )
            else
                -- Encourage the player to do better
                native.showAlert( "Sorry...", "Better luck next time!", { "OK" } )
            end
        end

    -- Apple Game Center score submission
    elseif ( globalData.gameCenter ) then

        if ( event.type == "setHighScore" ) then
            -- Congratulate player on a high score
            native.showAlert( "Congratulations", "You set a high score!", { "OK" } )
        else
            -- Encourage the player to do better
            native.showAlert( "Sorry...", "Better luck next time!", { "OK" } )
        end
    end
end</pre>
<div class="docs-tip-outer">
<div class="docs-tip-inner-left">
<div class="fa fa-cog">

</div>
</div>
<div class="docs-tip-inner-right">
<p>Note that because each network returns different data, we must test for the proper network and handle returned data independently.</p>
</div>
</div>
<p>With the listener function in place, we can now submit a score to either of the respective services. For this task, you will need the leaderboard identifiers that you acquired from Google or created for Apple. These must <strong>exactly</strong> match what the service is expecting.</p>
<p>For convenience later on, let’s wrap this in a function which accepts a single <code>score</code> parameter:</p>
<pre class="first-line: 85; gutter: true; brush: lua;">local function submitScore( score )

    if ( globalData.gpgs ) then
        -- Submit a score to Google Play Games Services
        globalData.gpgs.leaderboards.submit(
        {
            leaderboardId = "CgkA8kb12jK0onOQBg",
            score = score,
            listener = submitScoreListener
        })

    elseif ( globalData.gameCenter ) then
        -- Submit a score to Apple Game Center
        globalData.gameCenter.request( "setHighScore",
        {
            localPlayerScore = {
                category = "com.yourdomain.yourgame.leaderboard",
                value = score
            },
            listener = submitScoreListener
        })
    end
end</pre>
<p>Now, submitting a score is as easy as calling the <code>submitScore()</code> function, for example:</p>
<pre class="highlight: [1]; first-line: 1; gutter: false; brush: lua;">submitScore( 10000 )</pre>
</section>
<section id="showing-the-leaderboard" class="level2">
<h2>Showing the Leaderboard</h2>
<p>Games which include leaderboards must logically provide some way for players to view them. This might be triggered from the listener handler of a <a href="../../../api/library/widget/newButton.html">button widget</a> or, alternatively, it could be shown after the user achieves <nobr>(or fails to achieve)</nobr> a high score within the <code>submitScoreListener()</code> function we already created.</p>
<p>Whatever the method, showing a leaderboard can be done like this:</p>
<pre class="brush: lua;">if ( globalData.gpgs ) then
    -- Show a Google Play Games Services leaderboard
    globalData.gpgs.leaderboards.show( "CgkA8kb12jK0onOQBg" )

elseif ( globalData.gameCenter ) then
    -- Show an Apple Game Center leaderboard
    globalData.gameCenter.show( "leaderboards",
    {
        leaderboard = {
            category = "com.yourdomain.yourgame.leaderboard"
        }
    })
end</pre>
</section>
<section id="conclusion" class="level2">
<h2>Conclusion</h2>
<p>While your own game networking implementation can — and probably should — extend beyond just leaderboards, hopefully this tutorial gives you a solid foundation for building <nobr>cross-platform</nobr> game networking functionality using <a href="../../../plugin/gpgs/index.html">Google Play Games Services</a> and <a href="../../../plugin/gameNetwork-apple/index.html">Apple Game Center</a>.</p>
<hr>
<div id="footer">
<p class="copyright">
© 2020-2024 Solar2D All Rights Reserved.
</p>
<p class="feedback">
Help us help you! If you notice a problem with this page, please report it.
</p>
<p><a class="feedback-button" href="https://github.com/coronalabs/corona-docs/issues" target="_blank">Report an Issue</a></p>
</div>
</section>
</section>
<script src="https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shCore.js" type="text/javascript"></script>
<script src="https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shAutoloader.js" type="text/javascript"></script>
<script type="text/javascript">
    // Define syntax highlighting scripts.
    // N.B.: As a safeguard, you will need to whitelist the brush in filter-SyntaxHighlighter.py

    SyntaxHighlighter.autoloader(
      ['c#','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushCSharp.js'],
      ['java','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushJava.js'],
      ['js','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushJScript.js'],
      ['lua','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushLua.js'],
      ['php','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushPhp.js'],
      ['sql','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushSql.js'],
      ['xml','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushXml.js']
    );

    // Set default configurations.
    SyntaxHighlighter.defaults['gutter'] = false; // Disable line numbers.
    SyntaxHighlighter.defaults['toolbar'] = false; // Disable link back to author's site. :(
	SyntaxHighlighter.defaults['quick-code'] = false; // Disable double click feature

    // Perform the highlighting.
    SyntaxHighlighter.all();
</script>
</body>
</html>
