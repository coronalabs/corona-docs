<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="https://www.w3.org/1999/xhtml">
<head>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Cousine&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="icon" type="image/ico" href="/images/favicon.ico" />
  <link rel="shortcut icon" type="image/png" href="/images/favicon.png" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title>Solar2D Documentation — Tutorials | Gaming/Physics</title>
  <meta name="description" content="Solar2D lets you build games/apps for all major platforms including iOS, Android, Kindle, Apple TV, Android TV, macOS, and Windows. Get the free toolset!" />
  <link rel="stylesheet" href="../../../css/style.css" />
  <link rel="stylesheet" href="../../../css/shCoreDefault.css" />
<script src="https://corona-cdn.coronalabs.com/js/docs.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-9574984-14', 'auto');
  ga('send', 'pageview');
</script>
</head>
<body>
<div class="header"></div>
<div class="title">
	<span class="titleimg" onclick="window.location='https://docs.coronalabs.com/'"></span>
	<div id="nav">
		<ul>
<li><a href="../../../guide/programming/index.html">Getting Started</a></li>
<li><a href="../../../guide/index.html">Guides</a></li>
<li><a href="../../../api/index.html">API Reference</a></li>
<li><a href="../../../tutorial/index.html">Tutorials</a></li>
<li><a href="../../../plugin/index.html">Plugins</a></li>
<li><a href="../../../native/index.html">Solar2D Native</a></li>
<li><a href="../../../coronacards/index.html">CoronaCards</a></li>
</ul>

		<!--
		<div id="resources-link"><a href="https://coronalabs.com/resources/">Corona Resources</a></div>
		-->
	</div>
</div>

<div class="SearchBar">
  <form action="https://www.google.com/cse" id="cse-search-box">
  <input type="hidden" name="cx" value="009283852522218786394:g40gqt2m6rq" />
  <input type="hidden" name="ie" value="UTF-8" />
  <input type="text" placeholder="Search" name="q" id="q" autocomplete="off" size="40" />
  <input type="submit" name="sa" value="Search" />
  </form>
</div>
<div id="TOC">
<ul>
<li><a href="#radial-gravity">Radial Gravity</a><ul>
<li><a href="#test-project-setup">Test Project Setup</a></li>
<li><a href="#creating-the-radial-field">Creating the Radial Field</a></li>
<li><a href="#objects-colliding-with-field">Objects Colliding With Field</a><ul>
<li><a href="#objects-entering-field">Objects Entering Field</a></li>
<li><a href="#objects-exiting-field">Objects Exiting Field</a></li>
</ul></li>
<li><a href="#generating-objects">Generating Objects</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul></li>
</ul>
</div>
<div id="breadcrumb">
<a href="https://docs.coronalabs.com">Documentation</a>  ▸  <a href="../../../tutorial/index.html">Tutorials</a>  ▸  <a href="../../../tutorial/games/index.html">Gaming/Physics</a>
</div>
<section id="radial-gravity" class="level1">
<h1>Radial Gravity</h1>
<p>Although Corona’s Box2D-powered physics engine can easily simulate <strong>x</strong> and <strong>y</strong> directional gravity, <strong>radial gravity</strong> isn’t <nobr>built-in</nobr> functionality. Fortunately, it can be accomplished relatively easily using standard physics collision events and a <strong>touch joint</strong>.</p>
<p>For those who don’t know what radial gravity is, it’s essentially like the simulated gravitational pull of a planet, or a magnet pulling outlying metal objects toward it. This tutorial will outline how to build a basic radial gravity simulation with properties that can be easily altered, including the size and strength of the gravitational field.</p>
<section id="test-project-setup" class="level2">
<h2>Test Project Setup</h2>
<p>For purposes of this tutorial, let’s quickly create a test project:</p>
<ol type="1">
<li><p>Open the Corona Simulator.</p></li>
<li><p>Click <strong>New Project</strong> from the welcome window or select <nobr><strong>New Project…</strong></nobr> from the <strong>File</strong> menu.</p></li>
<li><p>For the project/application name, type <code>RadialGravity</code> and ensure that the <strong>Blank</strong> template option is selected. Leave the screen size settings at default but set <strong>Default Orientation</strong> to <strong>Sideways</strong>, then click <strong>OK</strong> (Windows) or <strong>Next</strong> (Mac). This will create the basic files for the test project in the location (folder) that you specified.</p></li>
<li><p>Locate the project folder, open the <code>main.lua</code> file in your chosen text editor, then insert these lines of code:</p></li>
</ol>
<div class="code-indent">

<pre class="first-line: 1; gutter: false; brush: lua;">local physics = require( "physics" )
physics.start()  -- Start the physics engine
physics.setGravity( 0, 0 )  -- Set "space" gravity
math.randomseed( os.time() )  -- Seed the pseudo-random number generator

-- Set radial gravity simulation values
local fieldRadius = 120
local fieldPower = 0.4</pre>
</section>
<section id="creating-the-radial-field" class="level2">
<h2>Creating the Radial Field</h2>
<p>The first step is to create the gravitational field that will exert a pull force on objects that enter it. In Corona, we can create this field as a simple <strong>radial body</strong> set as a <strong>sensor</strong>. In your project, add the following lines:</p>
<pre class="first-line: 1; gutter: false; brush: lua;">local field = display.newCircle( display.contentCenterX, display.contentCenterY, fieldRadius )
field.alpha = 0.2

-- Add physical body (sensor) to field
physics.addBody( field, "static", { isSensor=true, radius=fieldRadius } )</pre>
</section>
<section id="objects-colliding-with-field" class="level2">
<h2>Objects Colliding With Field</h2>
<p>The common method behind other objects being affected by radial gravity is their collision with this field. Essentially, when an object <strong>enters</strong> the field — collision phase of <code>"began"</code> — we’ll create a physics <strong>touch joint</strong> between the object and the center of the field. Similarly, if an object <strong>exits</strong> the field <nobr>(collision phase of <code>"ended"</code>)</nobr>, we’ll break (remove) the touch joint and let the object go about its normal physical behavior.</p>
<section id="objects-entering-field" class="level3">
<h3>Objects Entering Field</h3>
<p>First, let’s add the following code to the project to handle objects which <strong>enter</strong> the gravitational field:</p>
<pre class="highlight: [3,5,8,9,10,11,12,13,14,15,16,17,18]; first-line: 1; gutter: false; brush: lua;">local function collideWithField( self, event )

    local objectToPull = event.other

    if ( event.phase == "began" and objectToPull.touchJoint == nil ) then

        -- Create touch joint after short delay (10 milliseconds)
        timer.performWithDelay( 10,
            function()
                -- Create touch joint
                objectToPull.touchJoint = physics.newJoint( "touch", objectToPull, objectToPull.x, objectToPull.y )
                -- Set physical properties of touch joint
                objectToPull.touchJoint.frequency = fieldPower
                objectToPull.touchJoint.dampingRatio = 0.0
                -- Set touch joint "target" to center of field
                objectToPull.touchJoint:setTarget( self.x, self.y )
            end
        )
    end
end
field.collision = collideWithField
field:addEventListener( "collision" )</pre>
<p>Inspecting this in more detail, we do the following:</p>
<ol type="1">
<li><p>First, with <nobr><code>local objectToPull = event.other</code></nobr>, we create a local reference to the object which collided with the field.</p></li>
<li><p>With the first conditional check, we confirm that the <code>"began"</code> phase has occurred <strong>and</strong> that the object doesn’t already have a touch joint applied (this second condition is simply an <nobr>additional fail-safe)</nobr>.</p></li>
<li><p>After a short timer delay (see notes below), we add a touch joint to the object, set the basic joint properties, and then set its <strong>target</strong> to the center of the gravitational field <nobr>(<code>self.x</code>/<code>self.y</code>)</nobr>.</p></li>
</ol>
<div class="guide-notebox">
<div class="notebox-title">
Notes
</div>
<ul>
<li><p>Because certain physical actions like creating joints can’t be done in the exact same time step as a collision, we must do so following a short timer <nobr>(here, 10 milliseconds)</nobr>. For simplicity, we use an anonymous function inside the <code>timer.performWithDelay()</code> call to create the touch joint.</p></li>
<li><p>In the case of a touch joint, you don’t actually join the object to another object as you would with most physical joints. For this joint type, the “target” is simply a point in world coordinates.</p></li>
</ul>
</div>
</section>
<section id="objects-exiting-field" class="level3">
<h3>Objects Exiting Field</h3>
<p>So that the gravitational field doesn’t maintain permanent control over objects which <strong>exit</strong> its radius, we need to add some code to break (remove) the object’s touch joint.</p>
<p>In your project, add the following code <strong>inside</strong> the existing <code>collideWithField()</code> function:</p>
<pre class="highlight: [20,21,22,23]; first-line: 1; gutter: false; brush: lua;">local function collideWithField( self, event )

    local objectToPull = event.other

    if ( event.phase == "began" and objectToPull.touchJoint == nil ) then

        -- Create touch joint after short delay (10 milliseconds)
        timer.performWithDelay( 10,
            function()
                -- Create touch joint
                objectToPull.touchJoint = physics.newJoint( "touch", objectToPull, objectToPull.x, objectToPull.y )
                -- Set physical properties of touch joint
                objectToPull.touchJoint.frequency = fieldPower
                objectToPull.touchJoint.dampingRatio = 0.0
                -- Set touch joint "target" to center of field
                objectToPull.touchJoint:setTarget( self.x, self.y )
            end
        )

    elseif ( event.phase == "ended" and objectToPull.touchJoint ~= nil ) then

        objectToPull.touchJoint:removeSelf()
        objectToPull.touchJoint = nil
    end
end</pre>
<p>This addition is simple: in the <code>"ended"</code> collision phase, we remove the touch joint, effectively allowing the object to continue on with its normal physical behavior.</p>
</section>
</section>
<section id="generating-objects" class="level2">
<h2>Generating Objects</h2>
<p>Let’s complete our project by generating 5 objects which approach the gravitational field at random speeds. Add the following code to your project following the previous lines:</p>
<pre class="brush: lua;">for i = 1,5 do

    local object = display.newCircle( 0, (i*50)+10, 10 )
    physics.addBody( object, { radius=10 } )

    local velocity = math.random( 80, 120 )
    object:setLinearVelocity( velocity, 0 )
end</pre>
<p>Now save the project, refresh/reload it, and you’ll see 5 white circles move toward the field. Upon contacting it, each circle will be drawn/attracted to the center of the field. Those moving fast enough may break free of the field’s radius and fly off on their own natural path, while those that remain inside the field will be continually pulled closer toward the center.</p>
<p>To test behavior variations, change the <code>fieldPower</code> variable value near the beginning of the project to something higher or lower. A lower value like <code>0.2</code> will make the field’s pull more gentle, while a higher value like <code>0.8</code> will pull objects very strongly toward the center.</p>
</section>
<section id="conclusion" class="level2">
<h2>Conclusion</h2>
<p>As you can see, simulating radial gravity is easily accomplished with some basic physics setup and one collision detection function. This concept can be used for planets with gravitational pull, magnets, or literally any other type of game object where you want to pull one or more objects toward another. Enjoy experimenting with the possibilities!</p>
<hr>
<div id="footer">
<p class="copyright">
© 2020-2024 Solar2D All Rights Reserved.
</p>
<p class="feedback">
Help us help you! If you notice a problem with this page, please report it.
</p>
<p><a class="feedback-button" href="https://github.com/coronalabs/corona-docs/issues" target="_blank">Report an Issue</a></p>
</div>
</section>
</section>
<script src="https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shCore.js" type="text/javascript"></script>
<script src="https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shAutoloader.js" type="text/javascript"></script>
<script type="text/javascript">
    // Define syntax highlighting scripts.
    // N.B.: As a safeguard, you will need to whitelist the brush in filter-SyntaxHighlighter.py

    SyntaxHighlighter.autoloader(
      ['c#','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushCSharp.js'],
      ['java','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushJava.js'],
      ['js','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushJScript.js'],
      ['lua','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushLua.js'],
      ['php','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushPhp.js'],
      ['sql','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushSql.js'],
      ['xml','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushXml.js']
    );

    // Set default configurations.
    SyntaxHighlighter.defaults['gutter'] = false; // Disable line numbers.
    SyntaxHighlighter.defaults['toolbar'] = false; // Disable link back to author's site. :(
	SyntaxHighlighter.defaults['quick-code'] = false; // Disable double click feature

    // Perform the highlighting.
    SyntaxHighlighter.all();
</script>
</body>
</html>
